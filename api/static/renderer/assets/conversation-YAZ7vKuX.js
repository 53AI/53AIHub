import{a8 as o,a9 as d,aa as w,ab as u}from"./main-A2Vq01lO.js";const c={vditor:{id:"vditor-lib",src:window.$getPublicPath("/libs/vditor/dist/index.min.js"),callback(){const t=document.createElement("link");t.rel="stylesheet",t.href=window.$getPublicPath("/libs/vditor/dist/index.css"),document.head.appendChild(t)}}},S=t=>c[t]?(c[t]._promise||(c[t]._promise=new Promise((e,s)=>{const{src:a,id:i,callback:n}=c[t],r=document.createElement("script");r.src=a,r.id=i,a.endsWith(".mjs")&&(r.type="module"),r.onload=()=>{n&&n(),setTimeout(()=>{e()},100)},r.onerror=()=>{s()},document.body.appendChild(r)})),c[t]._promise):Promise.reject(),Y=async(t,e="",s={})=>{t||(t=document.createElement("div")),await S("vditor"),window.Vditor.preview(t,e,{mode:"light",hljs:{lineNumber:!0,style:"github"},math:{inlineDigit:!0,macros:{}},cdn:window.$isElectron?"http://chat53dev.53ai.com/libs/js/vditor":window.$chat53ai.getPublicPath("/libs/vditor"),...s})},l={list(){return o.get("/api/conversations").catch(d)},create(t){return o.post("/api/conversations",t).catch(d)},edit(t,e){return o.put(`/api/conversations/${t}`,e).catch(d)},del(t){return o.delete(`/api/conversations/${t}`).catch(d)},messasges(t,e={}){return o.get(`/api/conversations/${t}/messages`,{params:e}).catch(d)}},x=(t={},e="")=>{const s=window.location.href,[a,i]=s.split("#"),n=i?i.split("?"):[""],r=e||n[0],m=n[1]||"",g=new URLSearchParams(m);Object.entries(t).forEach(([v,h])=>{h!=null?g.set(v,String(h)):g.delete(v)});const _=g.toString(),p=r+(_?`?${_}`:"");window.location.hash=p},f="usual_agents",A=(t,e)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):e}catch(s){return console.error(`Error reading localStorage key "${t}":`,s),e}},y=w("conversation-store",{state:()=>({conversations:[],agents:[],usual_agents:A(f,[]),current_agentid:0,current_conversationid:0}),getters:{currentAgent:t=>t.usual_agents.find(e=>e.agent_id===t.current_agentid)||{name:"",logo:"",agent_id:0,configs:"{}"},currentConversation:t=>t.conversations.find(e=>e.conversation_id===t.current_conversationid)||{conversation_id:0,title:"",create_time:0,update_time:0,top:0,is_valid:0,virtual_id:Date.now().toString()}},actions:{async loadConversations(){try{const t=await l.list();return this.conversations=t.data.conversations.map(e=>(e.created_at=u({date:e.created_time,format:"YYYY.MM.DD hh:mm"}),e.updated_at=u({date:e.updated_time,format:"YYYY.MM.DD hh:mm"}),e)),this.conversations}catch(t){throw console.error("Failed to load conversations:",t),t}},saveUsualAgents(){try{localStorage.setItem(f,JSON.stringify(this.usual_agents))}catch(t){console.error("Failed to save usual agents:",t)}},async pushUsualAgent(t){const e=this.usual_agents.findIndex(n=>n.agent_id===t.agent_id),s={...t,is_fixed:e>-1?this.usual_agents[e].is_fixed:!1},a=this.usual_agents.filter(n=>n.is_fixed&&n.agent_id!==t.agent_id),i=this.usual_agents.filter(n=>!n.is_fixed&&n.agent_id!==t.agent_id);s.is_fixed?this.usual_agents=[s,...a,...i]:this.usual_agents=[...a,s,...i],this.saveUsualAgents()},toggleUsualAgentFixed(t){const e=this.usual_agents.find(s=>s.agent_id===t.agent_id);if(e){e.is_fixed=!e.is_fixed;const s=this.usual_agents.filter(i=>i.is_fixed&&i.agent_id!==t.agent_id),a=this.usual_agents.filter(i=>!i.is_fixed&&i.agent_id!==t.agent_id);this.usual_agents=e.is_fixed?[e,...s,...a]:[...s,e,...a],this.saveUsualAgents()}},updateUsualAgents(t){this.usual_agents=this.usual_agents.map(e=>e.agent_id===t.agent_id?{...e,...t}:e),this.saveUsualAgents()},deleteUsualAgent(t){this.usual_agents=this.usual_agents.filter(e=>e.agent_id!==t.agent_id),this.saveUsualAgents()},createConversation(t,e=""){return l.create({agent_id:t,title:e}).then(s=>s.data)},addConversation(t){t.created_at=u({date:t.created_time,format:"YYYY.MM.DD hh:mm"}),t.updated_at=u({date:t.updated_time,format:"YYYY.MM.DD hh:mm"}),this.conversations.unshift(t)},updateConversation(t){this.conversations=this.conversations.map(e=>e.conversation_id===t.conversation_id?{...e,...t}:e)},async editConversation(t){const e={title:t.title};await l.edit(t.conversation_id,e),this.updateConversation(t)},async delConversation(t){this.conversations=this.conversations.filter(e=>e.conversation_id!==t.conversation_id),await l.del(t.conversation_id),this.current_conversationid===t.conversation_id&&this.setCurrentState(this.current_agentid,0)},updateAgents(t){this.agents=t,this.usual_agents=this.usual_agents.filter(e=>t.some(s=>s.agent_id===e.agent_id)),this.saveUsualAgents()},setCurrentState(t,e){var s;t&&(this.agents.find(i=>i.agent_id===t)||(t=((s=this.agents[0])==null?void 0:s.agent_id)||0)),e&&(this.conversations.find(i=>i.conversation_id===e)||(e=0)),this.current_agentid=t,this.current_conversationid=e,this.setRouter({agent_id:t||null,conversation_id:e||null})},clearCurrentState(){this.current_agentid=0,this.current_conversationid=0},setRouter(t={}){x(t,"/chat")}}});export{l as c,Y as m,y as u};
