import{at as Pe,k as Y,an as Ce,ay as q,aA as Le,aw as ve,y as ae,aB as he,aC as Ae,aD as Be,ao as ze,ak as Ee,aE as Me,r as k,aF as Ve,s as Ye,N as m,az as me,Y as _e,o as Se,aG as X,b as h,h as pe,i as p,f as d,T as Xe,d as b,n as v,O as e,X as ye,aH as De,$ as Fe,e as C,a2 as $,aI as He,c as N,H as ee,aJ as je,aK as Ke,aq as x,B as We,t as Ne,aL as qe,aM as Ze,aj as Ge,aN as Ue,aO as Je,I as Qe,g as ea,v as aa,aP as ta,am as Oe,aQ as V,aR as sa,ar as Re,aS as na,aT as oa,aU as la,l as ra,aV as be,aW as ke,aX as Ie,m as ia,a9 as ca,aY as ua,aZ as da}from"./main-B8r1lKmx.js";import{d as fa}from"./debounce-P1XZIO3e.js";var va="Expected a function";function fe(i,L,l){var s=!0,o=!0;if(typeof i!="function")throw new TypeError(va);return Pe(l)&&(s="leading"in l?!!l.leading:s,o="trailing"in l?!!l.trailing:o),fa(i,L,{leading:s,maxWait:L,trailing:o})}const ma=(i,L)=>{if(!Y||!i||!L)return!1;const l=i.getBoundingClientRect();let s;return L instanceof Element?s=L.getBoundingClientRect():s={top:0,right:window.innerWidth,bottom:window.innerHeight,left:0},l.top<s.bottom&&l.bottom>s.top&&l.right>s.left&&l.left<s.right},pa=Ce({urlList:{type:q(Array),default:()=>Le([])},zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},hideOnClickModal:Boolean,teleported:Boolean,closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),ga={close:()=>!0,switch:i=>ve(i),rotate:i=>ve(i)},wa=ae({name:"ElImageViewer"}),ha=ae({...wa,props:pa,emits:ga,setup(i,{expose:L,emit:l}){var s;const o=i,g={CONTAIN:{name:"contain",icon:he(Ae)},ORIGINAL:{name:"original",icon:he(Be)}};let D,F="";const{t:te}=ze(),n=Ee("image-viewer"),{nextZIndex:P}=Me(),z=k(),M=k([]),A=Ve(),f=k(!0),w=k(o.initialIndex),O=Ye(g.CONTAIN),c=k({scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}),se=k((s=o.zIndex)!=null?s:P()),H=m(()=>{const{urlList:a}=o;return a.length<=1}),Z=m(()=>w.value===0),j=m(()=>w.value===o.urlList.length-1),K=m(()=>o.urlList[w.value]),ne=m(()=>[n.e("btn"),n.e("prev"),n.is("disabled",!o.infinite&&Z.value)]),oe=m(()=>[n.e("btn"),n.e("next"),n.is("disabled",!o.infinite&&j.value)]),G=m(()=>{const{scale:a,deg:u,offsetX:r,offsetY:I,enableTransition:_}=c.value;let S=r/a,T=I/a;const W=u*Math.PI/180,ge=Math.cos(W),we=Math.sin(W);S=S*ge+T*we,T=T*ge-r/a*we;const de={transform:`scale(${a}) rotate(${u}deg) translate(${S}px, ${T}px)`,transition:_?"transform .3s":""};return O.value.name===g.CONTAIN.name&&(de.maxWidth=de.maxHeight="100%"),de}),U=m(()=>`${w.value+1} / ${o.urlList.length}`);function B(){Q(),D==null||D(),document.body.style.overflow=F,l("close")}function J(){const a=fe(r=>{switch(r.code){case V.esc:o.closeOnPressEscape&&B();break;case V.space:E();break;case V.left:ce();break;case V.up:R("zoomIn");break;case V.right:ue();break;case V.down:R("zoomOut");break}}),u=fe(r=>{const I=r.deltaY||r.deltaX;R(I<0?"zoomIn":"zoomOut",{zoomRate:o.zoomRate,enableTransition:!1})});A.run(()=>{X(document,"keydown",a),X(document,"wheel",u)})}function Q(){A.stop()}function le(){f.value=!1}function re(a){f.value=!1,a.target.alt=te("el.image.error")}function t(a){if(f.value||a.button!==0||!z.value)return;c.value.enableTransition=!1;const{offsetX:u,offsetY:r}=c.value,I=a.pageX,_=a.pageY,S=fe(W=>{c.value={...c.value,offsetX:u+W.pageX-I,offsetY:r+W.pageY-_}}),T=X(document,"mousemove",S);X(document,"mouseup",()=>{T()}),a.preventDefault()}function y(){c.value={scale:1,deg:0,offsetX:0,offsetY:0,enableTransition:!1}}function E(){if(f.value)return;const a=sa(g),u=Object.values(g),r=O.value.name,_=(u.findIndex(S=>S.name===r)+1)%a.length;O.value=g[a[_]],y()}function ie(a){const u=o.urlList.length;w.value=(a+u)%u}function ce(){Z.value&&!o.infinite||ie(w.value-1)}function ue(){j.value&&!o.infinite||ie(w.value+1)}function R(a,u={}){if(f.value)return;const{minScale:r,maxScale:I}=o,{zoomRate:_,rotateDeg:S,enableTransition:T}={zoomRate:o.zoomRate,rotateDeg:90,enableTransition:!0,...u};switch(a){case"zoomOut":c.value.scale>r&&(c.value.scale=Number.parseFloat((c.value.scale/_).toFixed(3)));break;case"zoomIn":c.value.scale<I&&(c.value.scale=Number.parseFloat((c.value.scale*_).toFixed(3)));break;case"clockwise":c.value.deg+=S,l("rotate",c.value.deg);break;case"anticlockwise":c.value.deg-=S,l("rotate",c.value.deg);break}c.value.enableTransition=T}function Te(a){var u;((u=a.detail)==null?void 0:u.focusReason)==="pointer"&&a.preventDefault()}function $e(){o.closeOnPressEscape&&B()}function xe(a){if(a.ctrlKey){if(a.deltaY<0)return a.preventDefault(),!1;if(a.deltaY>0)return a.preventDefault(),!1}}return me(K,()=>{_e(()=>{const a=M.value[0];a!=null&&a.complete||(f.value=!0)})}),me(w,a=>{y(),l("switch",a)}),Se(()=>{J(),D=X("wheel",xe,{passive:!1}),F=document.body.style.overflow,document.body.style.overflow="hidden"}),L({setActiveItem:ie}),(a,u)=>(h(),pe(e(ta),{to:"body",disabled:!a.teleported},{default:p(()=>[d(Xe,{name:"viewer-fade",appear:""},{default:p(()=>[b("div",{ref_key:"wrapper",ref:z,tabindex:-1,class:v(e(n).e("wrapper")),style:ye({zIndex:se.value})},[d(e(De),{loop:"",trapped:"","focus-trap-el":z.value,"focus-start-el":"container",onFocusoutPrevented:Te,onReleaseRequested:$e},{default:p(()=>[b("div",{class:v(e(n).e("mask")),onClick:Fe(r=>a.hideOnClickModal&&B(),["self"])},null,10,["onClick"]),C(" CLOSE "),b("span",{class:v([e(n).e("btn"),e(n).e("close")]),onClick:B},[d(e($),null,{default:p(()=>[d(e(He))]),_:1})],2),C(" ARROW "),e(H)?C("v-if",!0):(h(),N(ee,{key:0},[b("span",{class:v(e(ne)),onClick:ce},[d(e($),null,{default:p(()=>[d(e(je))]),_:1})],2),b("span",{class:v(e(oe)),onClick:ue},[d(e($),null,{default:p(()=>[d(e(Ke))]),_:1})],2)],64)),a.showProgress?(h(),N("div",{key:1,class:v([e(n).e("btn"),e(n).e("progress")])},[x(a.$slots,"progress",{activeIndex:w.value,total:a.urlList.length},()=>[We(Ne(e(U)),1)])],2)):C("v-if",!0),C(" ACTIONS "),b("div",{class:v([e(n).e("btn"),e(n).e("actions")])},[b("div",{class:v(e(n).e("actions__inner"))},[x(a.$slots,"toolbar",{actions:R,prev:ce,next:ue,reset:E,activeIndex:w.value},()=>[d(e($),{onClick:r=>R("zoomOut")},{default:p(()=>[d(e(qe))]),_:1},8,["onClick"]),d(e($),{onClick:r=>R("zoomIn")},{default:p(()=>[d(e(Ze))]),_:1},8,["onClick"]),b("i",{class:v(e(n).e("actions__divider"))},null,2),d(e($),{onClick:E},{default:p(()=>[(h(),pe(Ge(e(O).icon)))]),_:1}),b("i",{class:v(e(n).e("actions__divider"))},null,2),d(e($),{onClick:r=>R("anticlockwise")},{default:p(()=>[d(e(Ue))]),_:1},8,["onClick"]),d(e($),{onClick:r=>R("clockwise")},{default:p(()=>[d(e(Je))]),_:1},8,["onClick"])])],2)],2),C(" CANVAS "),b("div",{class:v(e(n).e("canvas"))},[(h(!0),N(ee,null,Qe(a.urlList,(r,I)=>ea((h(),N("img",{ref_for:!0,ref:_=>M.value[I]=_,key:r,src:r,style:ye(e(G)),class:v(e(n).e("img")),crossorigin:a.crossorigin,onLoad:le,onError:re,onMousedown:t},null,46,["src","crossorigin"])),[[aa,I===w.value]])),128))],2),x(a.$slots,"default")]),_:3},8,["focus-trap-el"])],6)]),_:3})]),_:3},8,["disabled"]))}});var ya=Oe(ha,[["__file","image-viewer.vue"]]);const ba=Re(ya),ka=Ce({hideOnClickModal:Boolean,src:{type:String,default:""},fit:{type:String,values:["","contain","cover","fill","none","scale-down"],default:""},loading:{type:String,values:["eager","lazy"]},lazy:Boolean,scrollContainer:{type:q([String,Object])},previewSrcList:{type:q(Array),default:()=>Le([])},previewTeleported:Boolean,zIndex:{type:Number},initialIndex:{type:Number,default:0},infinite:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},zoomRate:{type:Number,default:1.2},minScale:{type:Number,default:.2},maxScale:{type:Number,default:7},showProgress:{type:Boolean,default:!1},crossorigin:{type:q(String)}}),Ia={load:i=>i instanceof Event,error:i=>i instanceof Event,switch:i=>ve(i),close:()=>!0,show:()=>!0},Ca=ae({name:"ElImage",inheritAttrs:!1}),La=ae({...Ca,props:ka,emits:Ia,setup(i,{expose:L,emit:l}){const s=i,{t:o}=ze(),g=Ee("image"),D=na(),F=m(()=>oa(Object.entries(D).filter(([t])=>/^(data-|on[A-Z])/i.test(t)||["id","style"].includes(t)))),te=la({excludeListeners:!0,excludeKeys:m(()=>Object.keys(F.value))}),n=k(),P=k(!1),z=k(!0),M=k(!1),A=k(),f=k(),w=Y&&"loading"in HTMLImageElement.prototype;let O;const c=m(()=>[g.e("inner"),H.value&&g.e("preview"),z.value&&g.is("loading")]),se=m(()=>{const{fit:t}=s;return Y&&t?{objectFit:t}:{}}),H=m(()=>{const{previewSrcList:t}=s;return ra(t)&&t.length>0}),Z=m(()=>{const{previewSrcList:t,initialIndex:y}=s;let E=y;return y>t.length-1&&(E=0),E}),j=m(()=>s.loading==="eager"?!1:!w&&s.loading==="lazy"||s.lazy),K=()=>{Y&&(z.value=!0,P.value=!1,n.value=s.src)};function ne(t){z.value=!1,P.value=!1,l("load",t)}function oe(t){z.value=!1,P.value=!0,l("error",t)}function G(){ma(A.value,f.value)&&(K(),J())}const U=da(G,200,!0);async function B(){var t;if(!Y)return;await _e();const{scrollContainer:y}=s;ia(y)?f.value=y:ca(y)&&y!==""?f.value=(t=document.querySelector(y))!=null?t:void 0:A.value&&(f.value=ua(A.value)),f.value&&(O=X(f,"scroll",U),setTimeout(()=>G(),100))}function J(){!Y||!f.value||!U||(O==null||O(),f.value=void 0)}function Q(){H.value&&(M.value=!0,l("show"))}function le(){M.value=!1,l("close")}function re(t){l("switch",t)}return me(()=>s.src,()=>{j.value?(z.value=!0,P.value=!1,J(),B()):K()}),Se(()=>{j.value?B():K()}),L({showPreview:Q}),(t,y)=>(h(),N("div",be({ref_key:"container",ref:A},e(F),{class:[e(g).b(),t.$attrs.class]}),[P.value?x(t.$slots,"error",{key:0},()=>[b("div",{class:v(e(g).e("error"))},Ne(e(o)("el.image.error")),3)]):(h(),N(ee,{key:1},[n.value!==void 0?(h(),N("img",be({key:0},e(te),{src:n.value,loading:t.loading,style:e(se),class:e(c),crossorigin:t.crossorigin,onClick:Q,onLoad:ne,onError:oe}),null,16,["src","loading","crossorigin"])):C("v-if",!0),z.value?(h(),N("div",{key:1,class:v(e(g).e("wrapper"))},[x(t.$slots,"placeholder",{},()=>[b("div",{class:v(e(g).e("placeholder"))},null,2)])],2)):C("v-if",!0)],64)),e(H)?(h(),N(ee,{key:2},[M.value?(h(),pe(e(ba),{key:0,"z-index":t.zIndex,"initial-index":e(Z),infinite:t.infinite,"zoom-rate":t.zoomRate,"min-scale":t.minScale,"max-scale":t.maxScale,"show-progress":t.showProgress,"url-list":t.previewSrcList,crossorigin:t.crossorigin,"hide-on-click-modal":t.hideOnClickModal,teleported:t.previewTeleported,"close-on-press-escape":t.closeOnPressEscape,onClose:le,onSwitch:re},{progress:p(E=>[x(t.$slots,"progress",ke(Ie(E)))]),toolbar:p(E=>[x(t.$slots,"toolbar",ke(Ie(E)))]),default:p(()=>[t.$slots.viewer?(h(),N("div",{key:0},[x(t.$slots,"viewer")])):C("v-if",!0)]),_:3},8,["z-index","initial-index","infinite","zoom-rate","min-scale","max-scale","show-progress","url-list","crossorigin","hide-on-click-modal","teleported","close-on-press-escape"])):C("v-if",!0)],64)):C("v-if",!0)],16))}});var za=Oe(La,[["__file","image.vue"]]);const Sa=Re(za);export{Sa as E,fe as t};
