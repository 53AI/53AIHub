import{G as o,I as c,q as m}from"./main-aAIm056l.js";const Y=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"],h=({date:t,format:e="YYYY-MM-DD hh:mm:ss",fillZero:s=!0}={date:new Date})=>{t||(t=new Date),typeof t=="string"&&(t=t.replace(/-/gm,"/")),t=new Date(t);const[i,n,a,u,g,r,d]=[`${t.getFullYear()}`,`${t.getMonth()+1}`,`${t.getDate()}`,`${t.getHours()}`,`${t.getMinutes()}`,`${t.getSeconds()}`,t.getDay()];return e.replace("YYYY",i).replace("YY",i.substring(2)).replace("MM",n.length===1&&s?`0${n}`:n).replace("DD",a.length===1&&s?`0${a}`:a).replace("hh",u.length===1&&s?`0${u}`:u).replace("mm",g.length===1&&s?`0${g}`:g).replace("ss",r.length===1&&s?`0${r}`:r).replace("week",Y[d]||"")},l={list(){return o.get("/api/conversations").catch(c)},create(t){return o.post("/api/conversations",t).catch(c)},edit(t,e){return o.put(`/api/conversations/${t}`,e).catch(c)},del(t){return o.delete(`/api/conversations/${t}`).catch(c)},messasges(t,e={}){return o.get(`/api/conversations/${t}/messages`,{params:e}).catch(c)},detail(t){return o.get(`/api/conversations/${t}`).catch(c)}},S=(t={},e="")=>{const s=window.location.href,[i,n]=s.split("#"),a=n?n.split("?"):[""],u=e||a[0],g=a[1]||"",r=new URLSearchParams(g);Object.entries(t).forEach(([f,_])=>{_!=null?r.set(f,String(_)):r.delete(f)});const d=r.toString(),p=u+(d?`?${d}`:"");window.location.hash=p},v="usual_agents",A=(t,e)=>{try{const s=localStorage.getItem(t);return s?JSON.parse(s):e}catch(s){return console.error(`Error reading localStorage key "${t}":`,s),e}},w=m("conversation-store",{state:()=>({conversations:[],agents:[],usual_agents:A(v,[]),current_agentid:0,current_conversationid:0}),getters:{currentAgent:t=>t.usual_agents.find(e=>e.agent_id===t.current_agentid)||{name:"",logo:"",agent_id:0,configs:"{}"},currentConversation:t=>t.conversations.find(e=>e.conversation_id===t.current_conversationid)||{conversation_id:0,title:"",create_time:0,update_time:0,top:0,is_valid:0,virtual_id:Date.now().toString()}},actions:{async loadConversations(){try{const t=await l.list();return this.conversations=t.data.conversations.map(e=>(e.created_at=h({date:e.created_time,format:"YYYY.MM.DD hh:mm"}),e.updated_at=h({date:e.updated_time,format:"YYYY.MM.DD hh:mm"}),e)),this.conversations}catch(t){throw console.error("Failed to load conversations:",t),t}},saveUsualAgents(){try{localStorage.setItem(v,JSON.stringify(this.usual_agents))}catch(t){console.error("Failed to save usual agents:",t)}},async pushUsualAgent(t){const e=this.usual_agents.findIndex(a=>a.agent_id===t.agent_id),s={...t,is_fixed:e>-1?this.usual_agents[e].is_fixed:!1},i=this.usual_agents.filter(a=>a.is_fixed&&a.agent_id!==t.agent_id),n=this.usual_agents.filter(a=>!a.is_fixed&&a.agent_id!==t.agent_id);s.is_fixed?this.usual_agents=[s,...i,...n]:this.usual_agents=[...i,s,...n],this.saveUsualAgents()},toggleUsualAgentFixed(t){const e=this.usual_agents.find(s=>s.agent_id===t.agent_id);if(e){e.is_fixed=!e.is_fixed;const s=this.usual_agents.filter(n=>n.is_fixed&&n.agent_id!==t.agent_id),i=this.usual_agents.filter(n=>!n.is_fixed&&n.agent_id!==t.agent_id);this.usual_agents=e.is_fixed?[e,...s,...i]:[...s,e,...i],this.saveUsualAgents()}},updateUsualAgents(t){this.usual_agents=this.usual_agents.map(e=>e.agent_id===t.agent_id?{...e,...t}:e),this.saveUsualAgents()},deleteUsualAgent(t){this.usual_agents=this.usual_agents.filter(e=>e.agent_id!==t.agent_id),this.saveUsualAgents()},createConversation(t,e=""){return l.create({agent_id:t,title:e}).then(s=>s.data)},addConversation(t){t.created_at=h({date:t.created_time,format:"YYYY.MM.DD hh:mm"}),t.updated_at=h({date:t.updated_time,format:"YYYY.MM.DD hh:mm"}),this.conversations.unshift(t)},updateConversation(t){this.conversations=this.conversations.map(e=>e.conversation_id===t.conversation_id?{...e,...t}:e)},async editConversation(t){const e={title:t.title};await l.edit(t.conversation_id,e),this.updateConversation(t)},async delConversation(t){this.conversations=this.conversations.filter(e=>e.conversation_id!==t.conversation_id),await l.del(t.conversation_id),this.current_conversationid===t.conversation_id&&this.setCurrentState(this.current_agentid,0)},updateAgents(t){this.agents=t,this.usual_agents=this.usual_agents.filter(e=>t.some(s=>s.agent_id===e.agent_id)),this.saveUsualAgents()},setCurrentState(t,e){var s;t&&(this.agents.find(n=>n.agent_id===t)||(t=((s=this.agents[0])==null?void 0:s.agent_id)||0)),e&&(this.conversations.find(n=>n.conversation_id===e)||(e=0)),this.current_agentid=t,this.current_conversationid=e,this.setRouter({agent_id:t||null,conversation_id:e||null})},clearCurrentState(){this.current_agentid=0,this.current_conversationid=0},setRouter(t={}){S(t,"/chat")}}});export{l as c,w as u};
