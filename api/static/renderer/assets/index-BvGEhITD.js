import{B as X,a8 as Z,C as ee,al as he,r as te,E as K,G as y,ao as we,i as ke,o as se,n as ye,a as Ee,H as N,W as T,c as i,b as l,F as f,e as _,d as t,f as r,u as s,k as b,w as p,a0 as L,t as u,L as be,M as Ce,K as C,m as V,h as v,ap as B,$ as U,Y as $e,p as A,s as Q,aq as De,ar as Se,ag as Ae,a1 as ze,as as Le,at as Ve,A as Fe,Q as He,au as Me,av as Te}from"./main-CF3M_8Rw.js";import{useEnterpriseStore as oe}from"./enterprise-CeHMY4Ox.js";import{E as Be,a as Ue,b as Ne}from"./el-dropdown-item-xlhaF7k9.js";/* empty css                  */import{E as Re}from"./el-image-viewer-DsI3uXTo.js";import{u as Pe}from"./global-DfLOwvjP.js";import{u as Ie}from"./conversation-DYW4gvfb.js";import{u as Ge}from"./links-Dh1n9IDk.js";import{u as Je}from"./navigation-DbPJLO8Q.js";import{E as Oe}from"./index-u7B4p2yp.js";const We={key:1,class:"absolute top-0 left-0 w-full h-full z-[10] bg-black/60"},je={class:"px-3 h-[70px] flex items-center gap-2"},qe=["src"],Ke={class:"flex-1 py-3 overflow-y-auto"},Qe={class:"px-5 pb-2"},Ye={key:0,class:"px-5"},Xe={class:"h-9 flex items-center gap-2"},Ze={class:"text-sm text-[#939499]"},et={class:"flex flex-col gap-1"},tt=["onClick"],st=["innerHTML"],ot={class:"h-9 flex items-center gap-2"},nt={class:"text-sm text-[#939499] max-w-[100px] truncate"},at={class:"flex flex-col gap-1"},lt=["onClick"],rt=["innerHTML"],it={class:"h-9 flex items-center gap-2"},dt={class:"text-sm text-[#939499] max-w-[100px] truncate"},ct={class:"flex flex-col gap-1"},ut=["href"],pt=["innerHTML"],mt={class:"h-9 flex items-center gap-2"},ft={class:"text-sm text-[#939499]"},_t={class:"flex flex-col gap-1"},gt=["onClick"],xt={class:"flex-1 text-sm text-[#1D1E1F] truncate"},vt={key:0,class:"px-2"},ht={class:"size-7 flex-center"},wt={class:"flex-1 text-base"},kt={class:"px-3"},yt=["onClick"],Et={class:"flex-1 text-sm truncate"},bt=["onClick"],Ct={class:"flex flex-col px-2 max-md:hidden"},$t={class:"size-7 flex-center"},Dt={class:"flex-1 text-base text-[#000000] truncate"},St={class:"size-7 flex-center"},At={class:"flex-1 text-base text-[#000000] truncate"},zt={class:"size-7 flex-center"},Lt={class:"flex-1 text-base truncate"},Vt={class:"size-7 flex-center"},Ft={class:"flex-1 text-base text-[#000000]"},Ht={class:"px-2 mt-1.5"},Mt={class:"size-7 flex-center"},Tt={class:"flex-1 text-base"},Bt={class:"px-3"},Ut={class:"h-[30px] pl-6 pr-2 flex items-center text-xs text-[#9A9A9A] mb-1"},Nt=["onClick"],Rt={class:"flex-1 text-sm text-[#1D1E1F] truncate"},Pt={class:"text-[#FA5151] flex-center"},It={class:"flex-1 flex items-center overflow-hidden"},Gt={class:"text-sm text-primary font-medium truncate"},Jt=["title"],Ot=["src"],Wt={class:"max-w-[5em] truncate"},Y=4,jt=X({__name:"sider",setup(ne){const $=Z(),g=ee(),D=he(),c=Pe(),F=Ge(),d=Ie(),M=oe(),E=Je(),H=te(),n=K({keyword:"",sidebarCollapsed:!1,agentCollapsed:!1,showUsualAgents:!0,showConversations:!0,editVisible:!1,showHistory:!1,expandHistory:!1}),S=K({conversation_id:0,title:""}),ae=y(()=>n.agentCollapsed?d.usual_agents:d.usual_agents.slice(0,Y)),le=y(()=>d.currentAgent),R=y(()=>d.currentConversation),P=y(()=>n.keyword?d.usual_agents.filter(e=>e.name.toLowerCase().includes(n.keyword.toLowerCase())).map(e=>({...e,formt_name:e.name.replace(new RegExp(n.keyword,"g"),`<span class="text-theme">${n.keyword}</span>`)})):[]),I=y(()=>n.keyword?D.agentList.filter(e=>e.name.toLowerCase().includes(n.keyword.toLowerCase())).map(e=>({...e,formt_name:e.name.replace(new RegExp(n.keyword,"g"),`<span class="text-theme">${n.keyword}</span>`)})):[]),G=y(()=>n.keyword?F.links.filter(e=>e.name.toLowerCase().includes(n.keyword.toLowerCase())).map(e=>({...e,name:e.name.replace(new RegExp(n.keyword,"g"),`<span class="text-theme">${n.keyword}</span>`)})):[]),J=y(()=>n.keyword?d.conversations.filter(e=>e.title.toLowerCase().includes(n.keyword.toLowerCase())).map(e=>({...e,name:e.title.replace(new RegExp(n.keyword,"g"),`<span class="text-theme">${n.keyword}</span>`)})):[]),re=y(()=>{const e=new Date;e.setHours(0,0,0,0);const a=new Date(e);a.setDate(a.getDate()-1);const h=new Date(e);h.setDate(h.getDate()-7);const m=n.expandHistory?d.conversations:d.conversations.slice(0,5);return[{key:"time.today",list:m.filter(w=>new Date(w.updated_time)>=e)},{key:"time.yesterday",list:m.filter(w=>{const x=new Date(w.updated_time);return x>=a&&x<e})},{key:"time.week_last",list:m.filter(w=>{const x=new Date(w.updated_time);return x>=h&&x<a})},{key:"time.week_ago",list:m.filter(w=>new Date(w.updated_time)<h)}]});we(H,()=>{!c.siderVisible&&c.siderCollapsed&&(c.siderCollapsed=!1)}),ke(()=>{c.siderVisible=!c.isMdScreen});const ie=()=>{n.agentCollapsed=!n.agentCollapsed},de=()=>d.editConversation(S).then(()=>{n.editVisible=!1}),ce=async e=>{await Oe.confirm(window.$t("chat.conversation_confirm_delete"),window.$t("action.del"),{confirmButtonText:window.$t("action.del"),cancelButtonText:window.$t("action.cancel"),type:"warning"}),d.delConversation(e)},ue=(e,a)=>{e==="del"?ce(a):e==="edit"&&(S.conversation_id=a.conversation_id,S.title=a.title,n.editVisible=!0)},pe=()=>{window.$isElectron?window.$chat53ai.$win({type:"new-tab",data:JSON.stringify({title:"AI知识库",closable:!0,ability:!1,urls:["http://ziroom.hub.53ai.com/space"]})}):window.open("http://ziroom.hub.53ai.com/space","_blank")},me=()=>{Ve.push({name:"Profile"}),c.toggleSider()};return se(async()=>{D.loadCategorys(),E.fetchNavigations(),await D.loadAgentList(),g.is_login&&await d.loadConversations(),d.updateAgents(D.agentList),ye(()=>{F.loadLinks()})}),Ee(()=>{d.clearCurrentState()}),(e,a)=>{const h=N("router-link"),m=N("svg-icon"),w=Ce,x=Re,z=$e,O=Ue,fe=Be,_e=Ne,W=ze,ge=Le,j=T("tooltip"),xe=T("trim"),ve=T("debounce");return l(),i(f,null,[!s(c).siderVisible&&!s(c).siderCollapsed&&!s(c).isMdScreen?(l(),i("div",{key:0,class:"w-4 h-full absolute left-0 top-0 z-[3] hover:bg-gray-100/50 transition-colors",onMouseenter:a[0]||(a[0]=o=>s(c).hoverSider(!0))},null,32)):_("",!0),s(c).isMdScreen&&s(c).siderCollapsed?(l(),i("div",We)):_("",!0),t("div",{ref_key:"siderRef",ref:H,class:A(["w-[280px] border-r flex flex-col bg-[#fff] transition-all duration-300 ease-linear md:bg-[#FAFAFA]",[{"absolute z-[11] left-0 -translate-x-full shadow-xl rounded-r":!s(c).siderVisible,"translate-x-0":!s(c).siderVisible&&s(c).siderCollapsed,"top-0 bottom-0":s(c).isMdScreen},s(c).isMdScreen?"top-0 bottom-0":"top-20 bottom-5"]]),onMouseleave:a[7]||(a[7]=o=>s(c).hoverSider(!1))},[t("div",je,[r(h,{to:{name:"Home"}},{default:p(()=>[t("img",{class:"size-8 rounded",src:s(M).logo,alt:"企业Logo"},null,8,qe)]),_:1}),r(h,{to:{name:"Home"},class:"flex-1 text-base text-primary truncate"},{default:p(()=>[L(u(s(M).display_name),1)]),_:1}),b((l(),i("div",{class:"flex-none size-7 rounded-md flex-center cursor-pointer hover:bg-[#ECEDEE]",onClick:a[1]||(a[1]=(...o)=>s(c).toggleSider&&s(c).toggleSider(...o))},[r(m,{name:"layout-left",size:"20",color:"#9A9A9A"})])),[[j,{content:s(c).siderVisible?e.$t("chat.collapse_side_bar"):e.$t("chat.expand_side_bar")}]])]),a[16]||(a[16]=t("div",{class:"border-b mx-2"},null,-1)),t("div",Ke,[t("div",Qe,[r(w,{modelValue:n.keyword,"onUpdate:modelValue":a[2]||(a[2]=o=>n.keyword=o),class:"el-input--main",placeholder:e.$t("action.search"),"prefix-icon":s(be),style:{"--el-input-inner-height":"36px","--el-input-border-color":"none"},clearable:""},null,8,["modelValue","placeholder","prefix-icon"])]),n.keyword?(l(),i("div",Ye,[P.value.length?(l(),i(f,{key:0},[t("div",Xe,[t("div",Ze,u(e.$t("module.chat")),1),a[11]||(a[11]=t("div",{class:"flex-1 h-px bg-[#E6E8EB]"},null,-1))]),t("div",et,[(l(!0),i(f,null,C(P.value,o=>(l(),i("div",{key:o.agent_id,class:"h-9 px-6 flex items-center gap-2 rounded cursor-pointer text-[#4F5052] hover:bg-[#ECEDEE]",onClick:k=>s(d).setCurrentState(o.agent_id,0)},[r(x,{class:"flex-none size-6 rounded-full",src:o.logo},null,8,["src"]),t("div",{class:"flex-1 text-sm truncate",innerHTML:o.formt_name},null,8,st)],8,tt))),128))])],64)):_("",!0),I.value.length?(l(),i(f,{key:1},[t("div",ot,[t("div",nt,u(s(E).promptNavigation.name||e.$t("module.agent")),1),a[12]||(a[12]=t("div",{class:"flex-1 h-px bg-[#E6E8EB]"},null,-1))]),t("div",at,[(l(!0),i(f,null,C(I.value,o=>(l(),i("div",{key:o.agent_id,class:"h-9 px-6 flex items-center gap-2 rounded cursor-pointer text-[#4F5052] hover:bg-[#ECEDEE]",onClick:()=>{s(d).pushUsualAgent(o),s(d).setCurrentState(o.agent_id,0)}},[r(x,{class:"flex-none size-6 rounded-full",src:o.logo},null,8,["src"]),t("div",{class:"flex-1 text-sm truncate",innerHTML:o.formt_name},null,8,rt)],8,lt))),128))])],64)):_("",!0),G.value.length?(l(),i(f,{key:2},[t("div",it,[t("div",dt,u(s(E).toolkitNavigation.name||e.$t("module.toolbox")),1),a[13]||(a[13]=t("div",{class:"flex-1 h-px bg-[#E6E8EB]"},null,-1))]),t("div",ct,[(l(!0),i(f,null,C(G.value,o=>(l(),i("a",{key:o.agent_id,href:o.url,target:"_blank",class:"h-9 px-6 flex items-center gap-2 rounded cursor-pointer text-[#4F5052] hover:bg-[#ECEDEE]"},[r(x,{class:"flex-none size-6 rounded-full",src:o.logo},null,8,["src"]),t("div",{class:"flex-1 text-sm truncate",innerHTML:o.name},null,8,pt)],8,ut))),128))])],64)):_("",!0),J.value.length?(l(),i(f,{key:3},[t("div",mt,[t("div",ft,u(e.$t("chat.history")),1),a[14]||(a[14]=t("div",{class:"flex-1 h-px bg-[#E6E8EB]"},null,-1))]),t("div",_t,[(l(!0),i(f,null,C(J.value,o=>(l(),i("div",{key:o.agent_id,class:"h-9 px-3 rounded-md flex items-center gap-2 mt-0.5 group cursor-pointer hover:bg-[#ECEDEE] overflow-hidden",onClick:k=>s(d).setCurrentState(o.agent_id,o.conversation_id)},[t("span",xt,u(o.title),1)],8,gt))),128))])],64)):_("",!0)])):_("",!0),b(t("div",null,[s(g).is_login?(l(),i("div",vt,[t("div",{class:"h-9 px-2 rounded-md flex items-center gap-0.5 cursor-pointer text-primary hover:bg-[#ECEDEE]",onClick:a[3]||(a[3]=o=>n.showUsualAgents=!n.showUsualAgents)},[t("div",ht,[r(m,{size:"18",name:"chat"})]),t("p",wt,u(e.$t("module.chat")),1),r(z,null,{default:p(()=>[n.showUsualAgents?(l(),v(s(B),{key:0})):(l(),v(s(U),{key:1}))]),_:1})])])):_("",!0),b(t("div",kt,[r(De,{name:"list",tag:"div",class:"flex flex-col gap-1 mt-2"},{default:p(()=>[(l(!0),i(f,null,C(ae.value,o=>(l(),i("div",{key:o.agent_id,class:A(["h-9 pl-6 pr-2 rounded-md flex items-center gap-2 cursor-pointer hover:bg-[#ECEDEE] group text-[#4F5052]",[le.value.agent_id===o.agent_id&&!R.value.conversation_id?"bg-[#ECEDEE] ":""]]),onClick:k=>s(d).setCurrentState(o.agent_id,0)},[r(x,{class:"flex-none size-6 rounded",src:o.logo},null,8,["src"]),t("div",Et,u(o.name),1),b((l(),i("div",{class:"size-7 flex-center",onClick:Q(k=>s(d).toggleUsualAgentFixed(o),["stop"])},[o.is_fixed?(l(),v(m,{key:0,name:"top",color:"#2563EB"})):(l(),v(m,{key:1,name:"top",color:"#4F5052",class:"invisible group-hover:visible"}))],8,bt)),[[j,{content:o.is_fixed?e.$t("action.unfixed"):e.$t("action.fixed")}],[V,!n.sidebarCollapsed]])],10,yt))),128))]),_:1}),s(d).usual_agents.length>Y?(l(),i("div",{key:0,class:"flex items-center gap-1 mt-3.5 ml-5 cursor-pointer text-[#9A9A9A]",onClick:ie},[b(t("span",{class:"text-sm"},u(n.agentCollapsed?e.$t("action.collapse"):e.$t("action.expand")),513),[[V,!n.sidebarCollapsed]]),r(z,null,{default:p(()=>[n.agentCollapsed?(l(),v(s(B),{key:0})):(l(),v(s(U),{key:1}))]),_:1})])):_("",!0)],512),[[V,n.showUsualAgents&&s(g).is_login]]),t("div",Ct,[r(h,{to:{name:"Agent"},class:A(["h-9 px-2 rounded-md flex items-center gap-0.5 mt-1.5 cursor-pointer text-[#4F5052] hover:bg-[#ECEDEE]",[s($).name==="Agent"?"bg-[#ECEDEE]":""]])},{default:p(()=>[t("div",$t,[r(m,{size:"18",name:"app",stroke:""})]),t("p",Dt,u(s(E).agentNavigation.name||e.$t("module.agent")),1)]),_:1},8,["class"]),r(h,{to:{name:"Prompt"},class:A(["h-9 px-2 rounded-md flex items-center gap-0.5 mt-1.5 cursor-pointer text-[#4F5052] hover:bg-[#ECEDEE]",[s($).name==="Prompt"?"bg-[#ECEDEE]":""]])},{default:p(()=>[t("div",St,[r(m,{size:"18",name:"prompt",stroke:""})]),t("p",At,u(s(E).promptNavigation.name||e.$t("module.prompt")),1)]),_:1},8,["class"]),r(h,{to:{name:"Toolkit"},class:A(["h-9 px-2 rounded-md flex items-center gap-0.5 mt-1.5 cursor-pointer text-primary hover:bg-[#ECEDEE]",[s($).name==="Toolkit"?"bg-[#ECEDEE]":""]])},{default:p(()=>[t("div",zt,[r(m,{size:"18",name:"toolkit",stroke:""})]),t("p",Lt,u(s(E).toolkitNavigation.name||e.$t("module.toolbox")),1)]),_:1},8,["class"]),e.$isElectron?(l(),i("div",{key:0,onClick:pe,href:"http://ziroom.hub.53ai.com/space",target:"_blank",class:"h-9 px-2 rounded-md flex items-center gap-0.5 cursor-pointer text-[#4F5052] hover:bg-[#ECEDEE]"},[t("div",Vt,[r(m,{size:"18",name:"tips"})]),t("p",Ft,u(e.$t("module.library")),1)])):_("",!0)]),s(g).is_login?(l(),i(f,{key:1},[a[15]||(a[15]=t("div",{class:"mx-2 border-t mt-1.5"},null,-1)),t("div",Ht,[t("div",{class:"h-9 px-2 rounded-md flex items-center gap-0.5 cursor-pointer text-primary hover:bg-[#ECEDEE]",onClick:a[4]||(a[4]=o=>n.showHistory=!n.showHistory)},[t("div",Mt,[r(m,{size:"18",name:"history"})]),t("p",Tt,u(e.$t("chat.history")),1),r(z,null,{default:p(()=>[n.showHistory?(l(),v(s(B),{key:0})):(l(),v(s(U),{key:1}))]),_:1})])])],64)):_("",!0),b(t("div",Bt,[(l(!0),i(f,null,C(re.value,o=>(l(),i(f,{key:o.key},[o.list.length?(l(),i(f,{key:0},[t("div",Ut,u(e.$t(o.key)),1),(l(!0),i(f,null,C(o.list,k=>(l(),i("div",{key:k.conversation_id,class:A(["h-9 pl-6 pr-2 rounded-md flex items-center gap-2 mt-0.5 group cursor-pointer hover:bg-[#ECEDEE] overflow-hidden",[R.value.conversation_id===k.conversation_id?"bg-[#F1F2F3]":""]]),onClick:q=>s(d).setCurrentState(k.agent_id,k.conversation_id)},[t("span",Rt,u(k.title),1),r(_e,{onCommand:q=>ue(q,k)},{dropdown:p(()=>[r(fe,null,{default:p(()=>[r(O,{command:"edit"},{default:p(()=>[r(m,{name:"edit",class:"mr-1"}),L(" "+u(e.$t("action.rename")),1)]),_:1}),r(O,{command:"del"},{default:p(()=>[t("span",Pt,[r(m,{name:"del",class:"mr-1"}),L(" "+u(e.$t("action.del")),1)])]),_:1})]),_:1})]),default:p(()=>[t("div",{class:"size-7 flex-center cursor-pointer invisible group-hover:visible max-md:visible",onClick:a[5]||(a[5]=Q(()=>{},["stop"]))},[r(z,{size:"14"},{default:p(()=>[r(s(Se))]),_:1})])]),_:2},1032,["onCommand"])],10,Nt))),128))],64)):_("",!0)],64))),128)),s(d).conversations.length>5&&!n.expandHistory?(l(),i("div",{key:0,class:"h-9 pl-6 pr-2 flex items-center text-sm text-[#9A9A9A] mb-1 cursor-pointer",onClick:a[6]||(a[6]=o=>n.expandHistory=!n.expandHistory)},u(e.$t("action.view_more")),1)):_("",!0)],512),[[V,n.showHistory]])],512),[[V,!n.keyword]])]),t("div",{onClick:me,class:"h-14 px-4 flex items-center gap-2 border-t border-b md:hidden"},[r(x,{class:"flex-none size-6",src:s(g).info.avatar,alt:"用户头像"},null,8,["src"]),t("div",It,[t("p",Gt,u(s(g).info.nickname),1),t("div",{class:"flex-none h-6 flex-center gap-1 bg-[#F7F7F7] rounded-full px-2 text-xs text-placeholder whitespace-nowrap",title:s(g).info.group_name},[t("img",{src:/\.png$/.test(s(g).info.group_icon)?s(g).info.group_icon:e.$getPublicPath(`/images/subscription/${s(g).info.group_icon}.png`),class:"w-4 h-4 object-cover",alt:"用户组图标"},null,8,Ot),t("p",Wt,u(s(g).info.group_name),1)],8,Jt)]),r(z,{size:"14",color:"#939499"},{default:p(()=>[r(s(Ae))]),_:1})])],34),r(ge,{modelValue:n.editVisible,"onUpdate:modelValue":a[10]||(a[10]=o=>n.editVisible=o),title:e.$t("chat.edit_conversation"),width:"480"},{footer:p(()=>[r(W,{onClick:a[9]||(a[9]=o=>n.editVisible=!1)},{default:p(()=>[L(u(e.$t("action.cancel")),1)]),_:1}),b((l(),v(W,{type:"primary",disabled:!S.title.trim(),onClick:de},{default:p(()=>[L(u(e.$t("action.confirm")),1)]),_:1},8,["disabled"])),[[ve]])]),default:p(()=>[b(r(w,{size:"large",modelValue:S.title,"onUpdate:modelValue":a[8]||(a[8]=o=>S.title=o),placeholder:e.$t("form.input_placeholder")},null,8,["modelValue","placeholder"]),[[xe]])]),_:1},8,["modelValue","title"])],64)}}}),qt=Fe(jt,[["__scopeId","data-v-0393e47d"]]),Kt={class:"h-screen flex"},ls=X({__name:"index",setup(ne){const $=te(),g=Z();ee();const D=oe();He();const c=y(()=>D.template_style_info.style_type==="software");Te("mainRef",$);const F=y(()=>["Chat","Agent","Toolkit","Prompt","PromptDetail","Profile"].includes(g.name)&&c.value);return se(()=>{}),(d,M)=>{const E=N("RouterView");return l(),i("div",Kt,[F.value?(l(),v(qt,{key:0})):_("",!0),t("main",{ref_key:"mainRef",ref:$,class:"flex-1 overflow-y-auto"},[r(E,null,{default:p(({Component:H,route:n})=>[(l(),v(Me(H),{key:n.path}))]),_:1})],512)])}}});export{ls as default};
