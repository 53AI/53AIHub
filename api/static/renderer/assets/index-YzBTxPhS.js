import{an as we,bK as So,bL as Bo,y as Q,ba as Mo,bm as Fo,N as B,r as O,ak as Se,ao as so,bM as Lo,ap as ao,b as w,h as J,i as m,f,T as Ne,O as p,g as oe,bN as lo,aH as ro,d as y,aV as he,$ as le,n as F,c as D,aq as q,t as H,e as Y,a2 as fe,aI as Pe,v as Ie,aP as Ro,am as te,ar as io,b6 as ue,a$ as X,o as De,b2 as ze,ay as x,aQ as z,bO as Oo,bd as ge,az as ke,aG as Ao,bP as ne,z as L,aW as No,aX as Po,bQ as Do,bR as qe,bS as zo,ax as Vo,a3 as Be,bC as co,bT as Ko,ah as uo,a_ as po,bU as Uo,al as Te,bk as Ho,bV as fo,Y as de,aj as ce,H as pe,bW as mo,bX as je,bY as Go,X as Fe,bc as vo,bZ as We,V as Ve,b_ as Jo,a6 as Yo,J as _e,aB as Le,b$ as Xe,c0 as Qe,c1 as qo,c2 as Re,a9 as Ke,c3 as jo,a5 as Wo,Z as $e,B as ee,c4 as Xo,k as Qo,u as go,c5 as ho,c6 as Ze,ac as _o,b9 as Zo,m as xe,M as xo,K as be,W as en,I as Oe,bv as on,C as nn,F as tn,c7 as eo,c8 as sn,P as an,_ as ln,a1 as rn,Q as cn}from"./main-B8r1lKmx.js";import{_ as dn}from"./main-header.vue_vue_type_script_setup_true_lang-bSEw2VRR.js";import{E as un}from"./el-scrollbar-1uaSUXqY.js";import{E as pn}from"./el-empty-Keg8_2xc.js";import{i as fn,E as mn,u as vn}from"./upload-1YCfHJd_.js";import{a as gn,E as hn}from"./el-tab-pane-d_50VU1i.js";import{u as bo,c as _n}from"./conversation-zxf9ascK.js";import"./el-image-viewer-d2TtpsQs.js";import"./debounce-P1XZIO3e.js";import"./el-loading-Zn4JAFDP.js";import"./enterprise-Dlct5MeJ.js";import"./global-g8PxrI0_.js";import"./strings-NhqI8Qjv.js";import"./index-BWUQcXSA.js";const bn=we({...So,direction:{type:String,default:"rtl",values:["ltr","rtl","ttb","btt"]},size:{type:[String,Number],default:"30%"},withHeader:{type:Boolean,default:!0},modalFade:{type:Boolean,default:!0},headerAriaLevel:{type:String,default:"2"}}),yn=Bo,wn=Q({name:"ElDrawer",inheritAttrs:!1}),Cn=Q({...wn,props:bn,emits:yn,setup(e,{expose:o}){const r=e,l=Mo();Fo({scope:"el-drawer",from:"the title slot",replacement:"the header slot",version:"3.0.0",ref:"https://element-plus.org/en-US/component/drawer.html#slots"},B(()=>!!l.title));const d=O(),s=O(),u=Se("drawer"),{t:v}=so(),{afterEnter:_,afterLeave:t,beforeLeave:a,visible:b,rendered:A,titleId:i,bodyId:h,zIndex:C,onModalClick:S,onOpenAutoFocus:P,onCloseAutoFocus:N,onFocusoutPrevented:M,onCloseRequested:R,handleClose:V}=Lo(r,d),K=B(()=>r.direction==="rtl"||r.direction==="ltr"),G=B(()=>ao(r.size));return o({handleClose:V,afterEnter:_,afterLeave:t}),($,n)=>(w(),J(p(Ro),{to:$.appendTo,disabled:$.appendTo!=="body"?!1:!$.appendToBody},{default:m(()=>[f(Ne,{name:p(u).b("fade"),onAfterEnter:p(_),onAfterLeave:p(t),onBeforeLeave:p(a),persisted:""},{default:m(()=>[oe(f(p(lo),{mask:$.modal,"overlay-class":$.modalClass,"z-index":p(C),onClick:p(S)},{default:m(()=>[f(p(ro),{loop:"",trapped:p(b),"focus-trap-el":d.value,"focus-start-el":s.value,onFocusAfterTrapped:p(P),onFocusAfterReleased:p(N),onFocusoutPrevented:p(M),onReleaseRequested:p(R)},{default:m(()=>[y("div",he({ref_key:"drawerRef",ref:d,"aria-modal":"true","aria-label":$.title||void 0,"aria-labelledby":$.title?void 0:p(i),"aria-describedby":p(h)},$.$attrs,{class:[p(u).b(),$.direction,p(b)&&"open"],style:p(K)?"width: "+p(G):"height: "+p(G),role:"dialog",onClick:le(()=>{},["stop"])}),[y("span",{ref_key:"focusStartRef",ref:s,class:F(p(u).e("sr-focus")),tabindex:"-1"},null,2),$.withHeader?(w(),D("header",{key:0,class:F([p(u).e("header"),$.headerClass])},[$.$slots.title?q($.$slots,"title",{key:1},()=>[Y(" DEPRECATED SLOT ")]):q($.$slots,"header",{key:0,close:p(V),titleId:p(i),titleClass:p(u).e("title")},()=>[$.$slots.title?Y("v-if",!0):(w(),D("span",{key:0,id:p(i),role:"heading","aria-level":$.headerAriaLevel,class:F(p(u).e("title"))},H($.title),11,["id","aria-level"]))]),$.showClose?(w(),D("button",{key:2,"aria-label":p(v)("el.drawer.close"),class:F(p(u).e("close-btn")),type:"button",onClick:p(V)},[f(p(fe),{class:F(p(u).e("close"))},{default:m(()=>[f(p(Pe))]),_:1},8,["class"])],10,["aria-label","onClick"])):Y("v-if",!0)],2)):Y("v-if",!0),p(A)?(w(),D("div",{key:1,id:p(h),class:F([p(u).e("body"),$.bodyClass])},[q($.$slots,"default")],10,["id"])):Y("v-if",!0),$.$slots.footer?(w(),D("div",{key:2,class:F([p(u).e("footer"),$.footerClass])},[q($.$slots,"footer")],2)):Y("v-if",!0)],16,["aria-label","aria-labelledby","aria-describedby","onClick"])]),_:3},8,["trapped","focus-trap-el","focus-start-el","onFocusAfterTrapped","onFocusAfterReleased","onFocusoutPrevented","onReleaseRequested"])]),_:3},8,["mask","overlay-class","z-index","onClick"]),[[Ie,p(b)]])]),_:3},8,["name","onAfterEnter","onAfterLeave","onBeforeLeave"])]),_:3},8,["to","disabled"]))}});var En=te(Cn,[["__file","drawer.vue"]]);const $n=io(En),In=Q({inheritAttrs:!1});function kn(e,o,r,l,d,s){return q(e.$slots,"default")}var Tn=te(In,[["render",kn],["__file","collection.vue"]]);const Sn=Q({name:"ElCollectionItem",inheritAttrs:!1});function Bn(e,o,r,l,d,s){return q(e.$slots,"default")}var Mn=te(Sn,[["render",Bn],["__file","collection-item.vue"]]);const yo="data-el-collection-item",wo=e=>{const o=`El${e}Collection`,r=`${o}Item`,l=Symbol(o),d=Symbol(r),s={...Tn,name:o,setup(){const v=O(),_=new Map;ue(l,{itemMap:_,getItems:()=>{const a=p(v);if(!a)return[];const b=Array.from(a.querySelectorAll(`[${yo}]`));return[..._.values()].sort((i,h)=>b.indexOf(i.ref)-b.indexOf(h.ref))},collectionRef:v})}},u={...Mn,name:r,setup(v,{attrs:_}){const t=O(),a=X(l,void 0);ue(d,{collectionItemRef:t}),De(()=>{const b=p(t);b&&a.itemMap.set(b,{ref:b,..._})}),ze(()=>{const b=p(t);a.itemMap.delete(b)})}};return{COLLECTION_INJECTION_KEY:l,COLLECTION_ITEM_INJECTION_KEY:d,ElCollection:s,ElCollectionItem:u}},Fn=we({style:{type:x([String,Array,Object])},currentTabId:{type:x(String)},defaultCurrentTabId:String,loop:Boolean,dir:{type:String,values:["ltr","rtl"],default:"ltr"},orientation:{type:x(String)},onBlur:Function,onFocus:Function,onMousedown:Function}),{ElCollection:Ln,ElCollectionItem:Rn,COLLECTION_INJECTION_KEY:Ue,COLLECTION_ITEM_INJECTION_KEY:On}=wo("RovingFocusGroup"),He=Symbol("elRovingFocusGroup"),Co=Symbol("elRovingFocusGroupItem"),An={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"},Nn=(e,o)=>{if(o!=="rtl")return e;switch(e){case z.right:return z.left;case z.left:return z.right;default:return e}},Pn=(e,o,r)=>{const l=Nn(e.code,r);if(!(o==="vertical"&&[z.left,z.right].includes(l))&&!(o==="horizontal"&&[z.up,z.down].includes(l)))return An[l]},Dn=(e,o)=>e.map((r,l)=>e[(l+o)%e.length]),Ge=e=>{const{activeElement:o}=document;for(const r of e)if(r===o||(r.focus(),o!==document.activeElement))return},oo="currentTabIdChange",no="rovingFocusGroup.entryFocus",zn={bubbles:!1,cancelable:!0},Vn=Q({name:"ElRovingFocusGroupImpl",inheritAttrs:!1,props:Fn,emits:[oo,"entryFocus"],setup(e,{emit:o}){var r;const l=O((r=e.currentTabId||e.defaultCurrentTabId)!=null?r:null),d=O(!1),s=O(!1),u=O(),{getItems:v}=X(Ue,void 0),_=B(()=>[{outline:"none"},e.style]),t=C=>{o(oo,C)},a=()=>{d.value=!0},b=ne(C=>{var S;(S=e.onMousedown)==null||S.call(e,C)},()=>{s.value=!0}),A=ne(C=>{var S;(S=e.onFocus)==null||S.call(e,C)},C=>{const S=!p(s),{target:P,currentTarget:N}=C;if(P===N&&S&&!p(d)){const M=new Event(no,zn);if(N==null||N.dispatchEvent(M),!M.defaultPrevented){const R=v().filter(n=>n.focusable),V=R.find(n=>n.active),K=R.find(n=>n.id===p(l)),$=[V,K,...R].filter(Boolean).map(n=>n.ref);Ge($)}}s.value=!1}),i=ne(C=>{var S;(S=e.onBlur)==null||S.call(e,C)},()=>{d.value=!1}),h=(...C)=>{o("entryFocus",...C)};ue(He,{currentTabbedId:Oo(l),loop:ge(e,"loop"),tabIndex:B(()=>p(d)?-1:0),rovingFocusGroupRef:u,rovingFocusGroupRootStyle:_,orientation:ge(e,"orientation"),dir:ge(e,"dir"),onItemFocus:t,onItemShiftTab:a,onBlur:i,onFocus:A,onMousedown:b}),ke(()=>e.currentTabId,C=>{l.value=C??null}),Ao(u,no,h)}});function Kn(e,o,r,l,d,s){return q(e.$slots,"default")}var Un=te(Vn,[["render",Kn],["__file","roving-focus-group-impl.vue"]]);const Hn=Q({name:"ElRovingFocusGroup",components:{ElFocusGroupCollection:Ln,ElRovingFocusGroupImpl:Un}});function Gn(e,o,r,l,d,s){const u=L("el-roving-focus-group-impl"),v=L("el-focus-group-collection");return w(),J(v,null,{default:m(()=>[f(u,No(Po(e.$attrs)),{default:m(()=>[q(e.$slots,"default")]),_:3},16)]),_:3})}var Jn=te(Hn,[["render",Gn],["__file","roving-focus-group.vue"]]);const Yn=we({trigger:Do.trigger,triggerKeys:{type:x(Array),default:()=>[z.enter,z.numpadEnter,z.space,z.down]},effect:{...qe.effect,default:"light"},type:{type:x(String)},placement:{type:x(String),default:"bottom"},popperOptions:{type:x(Object),default:()=>({})},id:String,size:{type:String,default:""},splitButton:Boolean,hideOnClick:{type:Boolean,default:!0},loop:{type:Boolean,default:!0},showTimeout:{type:Number,default:150},hideTimeout:{type:Number,default:150},tabindex:{type:x([Number,String]),default:0},maxHeight:{type:x([Number,String]),default:""},popperClass:{type:String,default:""},disabled:Boolean,role:{type:String,values:zo,default:"menu"},buttonProps:{type:x(Object)},teleported:qe.teleported,persistent:{type:Boolean,default:!0}}),Eo=we({command:{type:[Object,String,Number],default:()=>({})},disabled:Boolean,divided:Boolean,textValue:String,icon:{type:Vo}}),qn=we({onKeydown:{type:x(Function)}}),jn=[z.down,z.pageDown,z.home],$o=[z.up,z.pageUp,z.end],Wn=[...jn,...$o],{ElCollection:Xn,ElCollectionItem:Qn,COLLECTION_INJECTION_KEY:Zn,COLLECTION_ITEM_INJECTION_KEY:xn}=wo("Dropdown"),Me=Symbol("elDropdown"),{ButtonGroup:et}=Be,ot=Q({name:"ElDropdown",components:{ElButton:Be,ElButtonGroup:et,ElScrollbar:un,ElDropdownCollection:Xn,ElTooltip:co,ElRovingFocusGroup:Jn,ElOnlyChild:Ko,ElIcon:fe,ArrowDown:uo},props:Yn,emits:["visible-change","click","command"],setup(e,{emit:o}){const r=po(),l=Se("dropdown"),{t:d}=so(),s=O(),u=O(),v=O(),_=O(),t=O(null),a=O(null),b=O(!1),A=B(()=>({maxHeight:ao(e.maxHeight)})),i=B(()=>[l.m(R.value)]),h=B(()=>Uo(e.trigger)),C=Te().value,S=B(()=>e.id||C);ke([s,h],([c,T],[k])=>{var W,j,re;(W=k==null?void 0:k.$el)!=null&&W.removeEventListener&&k.$el.removeEventListener("pointerenter",K),(j=c==null?void 0:c.$el)!=null&&j.removeEventListener&&c.$el.removeEventListener("pointerenter",K),(re=c==null?void 0:c.$el)!=null&&re.addEventListener&&T.includes("hover")&&c.$el.addEventListener("pointerenter",K)},{immediate:!0}),ze(()=>{var c,T;(T=(c=s.value)==null?void 0:c.$el)!=null&&T.removeEventListener&&s.value.$el.removeEventListener("pointerenter",K)});function P(){N()}function N(){var c;(c=v.value)==null||c.onClose()}function M(){var c;(c=v.value)==null||c.onOpen()}const R=Ho();function V(...c){o("command",...c)}function K(){var c,T;(T=(c=s.value)==null?void 0:c.$el)==null||T.focus()}function G(){}function $(){const c=p(_);h.value.includes("hover")&&(c==null||c.focus()),a.value=null}function n(c){a.value=c}function g(c){b.value||(c.preventDefault(),c.stopImmediatePropagation())}function E(){o("visible-change",!0)}function I(c){var T;(c==null?void 0:c.type)==="keydown"&&((T=_.value)==null||T.focus())}function U(){o("visible-change",!1)}return ue(Me,{contentRef:_,role:B(()=>e.role),triggerId:S,isUsingKeyboard:b,onItemEnter:G,onItemLeave:$}),ue("elDropdown",{instance:r,dropdownSize:R,handleClick:P,commandHandler:V,trigger:ge(e,"trigger"),hideOnClick:ge(e,"hideOnClick")}),{t:d,ns:l,scrollbar:t,wrapStyle:A,dropdownTriggerKls:i,dropdownSize:R,triggerId:S,currentTabId:a,handleCurrentTabIdChange:n,handlerMainButtonClick:c=>{o("click",c)},handleEntryFocus:g,handleClose:N,handleOpen:M,handleBeforeShowTooltip:E,handleShowTooltip:I,handleBeforeHideTooltip:U,onFocusAfterTrapped:c=>{var T,k;c.preventDefault(),(k=(T=_.value)==null?void 0:T.focus)==null||k.call(T,{preventScroll:!0})},popperRef:v,contentRef:_,triggeringElementRef:s,referenceElementRef:u}}});function nt(e,o,r,l,d,s){var u;const v=L("el-dropdown-collection"),_=L("el-roving-focus-group"),t=L("el-scrollbar"),a=L("el-only-child"),b=L("el-tooltip"),A=L("el-button"),i=L("arrow-down"),h=L("el-icon"),C=L("el-button-group");return w(),D("div",{class:F([e.ns.b(),e.ns.is("disabled",e.disabled)])},[f(b,{ref:"popperRef",role:e.role,effect:e.effect,"fallback-placements":["bottom","top"],"popper-options":e.popperOptions,"gpu-acceleration":!1,"hide-after":e.trigger==="hover"?e.hideTimeout:0,"manual-mode":!0,placement:e.placement,"popper-class":[e.ns.e("popper"),e.popperClass],"reference-element":(u=e.referenceElementRef)==null?void 0:u.$el,trigger:e.trigger,"trigger-keys":e.triggerKeys,"trigger-target-el":e.contentRef,"show-after":e.trigger==="hover"?e.showTimeout:0,"stop-popper-mouse-event":!1,"virtual-ref":e.triggeringElementRef,"virtual-triggering":e.splitButton,disabled:e.disabled,transition:`${e.ns.namespace.value}-zoom-in-top`,teleported:e.teleported,pure:"",persistent:e.persistent,onBeforeShow:e.handleBeforeShowTooltip,onShow:e.handleShowTooltip,onBeforeHide:e.handleBeforeHideTooltip},fo({content:m(()=>[f(t,{ref:"scrollbar","wrap-style":e.wrapStyle,tag:"div","view-class":e.ns.e("list")},{default:m(()=>[f(_,{loop:e.loop,"current-tab-id":e.currentTabId,orientation:"horizontal",onCurrentTabIdChange:e.handleCurrentTabIdChange,onEntryFocus:e.handleEntryFocus},{default:m(()=>[f(v,null,{default:m(()=>[q(e.$slots,"dropdown")]),_:3})]),_:3},8,["loop","current-tab-id","onCurrentTabIdChange","onEntryFocus"])]),_:3},8,["wrap-style","view-class"])]),_:2},[e.splitButton?void 0:{name:"default",fn:m(()=>[f(a,{id:e.triggerId,ref:"triggeringElementRef",role:"button",tabindex:e.tabindex},{default:m(()=>[q(e.$slots,"default")]),_:3},8,["id","tabindex"])])}]),1032,["role","effect","popper-options","hide-after","placement","popper-class","reference-element","trigger","trigger-keys","trigger-target-el","show-after","virtual-ref","virtual-triggering","disabled","transition","teleported","persistent","onBeforeShow","onShow","onBeforeHide"]),e.splitButton?(w(),J(C,{key:0},{default:m(()=>[f(A,he({ref:"referenceElementRef"},e.buttonProps,{size:e.dropdownSize,type:e.type,disabled:e.disabled,tabindex:e.tabindex,onClick:e.handlerMainButtonClick}),{default:m(()=>[q(e.$slots,"default")]),_:3},16,["size","type","disabled","tabindex","onClick"]),f(A,he({id:e.triggerId,ref:"triggeringElementRef"},e.buttonProps,{role:"button",size:e.dropdownSize,type:e.type,class:e.ns.e("caret-button"),disabled:e.disabled,tabindex:e.tabindex,"aria-label":e.t("el.dropdown.toggleDropdown")}),{default:m(()=>[f(h,{class:F(e.ns.e("icon"))},{default:m(()=>[f(i)]),_:1},8,["class"])]),_:1},16,["id","size","type","class","disabled","tabindex","aria-label"])]),_:3})):Y("v-if",!0)],2)}var tt=te(ot,[["render",nt],["__file","dropdown.vue"]]);const st=Q({components:{ElRovingFocusCollectionItem:Rn},props:{focusable:{type:Boolean,default:!0},active:{type:Boolean,default:!1}},emits:["mousedown","focus","keydown"],setup(e,{emit:o}){const{currentTabbedId:r,loop:l,onItemFocus:d,onItemShiftTab:s}=X(He,void 0),{getItems:u}=X(Ue,void 0),v=Te(),_=O(),t=ne(i=>{o("mousedown",i)},i=>{e.focusable?d(p(v)):i.preventDefault()}),a=ne(i=>{o("focus",i)},()=>{d(p(v))}),b=ne(i=>{o("keydown",i)},i=>{const{code:h,shiftKey:C,target:S,currentTarget:P}=i;if(h===z.tab&&C){s();return}if(S!==P)return;const N=Pn(i);if(N){i.preventDefault();let R=u().filter(V=>V.focusable).map(V=>V.ref);switch(N){case"last":{R.reverse();break}case"prev":case"next":{N==="prev"&&R.reverse();const V=R.indexOf(P);R=l.value?Dn(R,V+1):R.slice(V+1);break}}de(()=>{Ge(R)})}}),A=B(()=>r.value===p(v));return ue(Co,{rovingFocusGroupItemRef:_,tabIndex:B(()=>p(A)?0:-1),handleMousedown:t,handleFocus:a,handleKeydown:b}),{id:v,handleKeydown:b,handleFocus:a,handleMousedown:t}}});function at(e,o,r,l,d,s){const u=L("el-roving-focus-collection-item");return w(),J(u,{id:e.id,focusable:e.focusable,active:e.active},{default:m(()=>[q(e.$slots,"default")]),_:3},8,["id","focusable","active"])}var lt=te(st,[["render",at],["__file","roving-focus-item.vue"]]);const rt=Q({name:"DropdownItemImpl",components:{ElIcon:fe},props:Eo,emits:["pointermove","pointerleave","click","clickimpl"],setup(e,{emit:o}){const r=Se("dropdown"),{role:l}=X(Me,void 0),{collectionItemRef:d}=X(xn,void 0),{collectionItemRef:s}=X(On,void 0),{rovingFocusGroupItemRef:u,tabIndex:v,handleFocus:_,handleKeydown:t,handleMousedown:a}=X(Co,void 0),b=mo(d,s,u),A=B(()=>l.value==="menu"?"menuitem":l.value==="navigation"?"link":"button"),i=ne(h=>{if([z.enter,z.numpadEnter,z.space].includes(h.code))return h.preventDefault(),h.stopImmediatePropagation(),o("clickimpl",h),!0},t);return{ns:r,itemRef:b,dataset:{[yo]:""},role:A,tabIndex:v,handleFocus:_,handleKeydown:i,handleMousedown:a}}});function it(e,o,r,l,d,s){const u=L("el-icon");return w(),D(pe,null,[e.divided?(w(),D("li",{key:0,role:"separator",class:F(e.ns.bem("menu","item","divided"))},null,2)):Y("v-if",!0),y("li",he({ref:e.itemRef},{...e.dataset,...e.$attrs},{"aria-disabled":e.disabled,class:[e.ns.be("menu","item"),e.ns.is("disabled",e.disabled)],tabindex:e.tabIndex,role:e.role,onClick:v=>e.$emit("clickimpl",v),onFocus:e.handleFocus,onKeydown:le(e.handleKeydown,["self"]),onMousedown:e.handleMousedown,onPointermove:v=>e.$emit("pointermove",v),onPointerleave:v=>e.$emit("pointerleave",v)}),[e.icon?(w(),J(u,{key:0},{default:m(()=>[(w(),J(ce(e.icon)))]),_:1})):Y("v-if",!0),q(e.$slots,"default")],16,["aria-disabled","tabindex","role","onClick","onFocus","onKeydown","onMousedown","onPointermove","onPointerleave"])],64)}var ct=te(rt,[["render",it],["__file","dropdown-item-impl.vue"]]);const Io=()=>{const e=X("elDropdown",{}),o=B(()=>e==null?void 0:e.dropdownSize);return{elDropdown:e,_elDropdownSize:o}},dt=Q({name:"ElDropdownItem",components:{ElDropdownCollectionItem:Qn,ElRovingFocusItem:lt,ElDropdownItemImpl:ct},inheritAttrs:!1,props:Eo,emits:["pointermove","pointerleave","click"],setup(e,{emit:o,attrs:r}){const{elDropdown:l}=Io(),d=po(),s=O(null),u=B(()=>{var i,h;return(h=(i=p(s))==null?void 0:i.textContent)!=null?h:""}),{onItemEnter:v,onItemLeave:_}=X(Me,void 0),t=ne(i=>(o("pointermove",i),i.defaultPrevented),je(i=>{if(e.disabled){_(i);return}const h=i.currentTarget;h===document.activeElement||h.contains(document.activeElement)||(v(i),i.defaultPrevented||h==null||h.focus())})),a=ne(i=>(o("pointerleave",i),i.defaultPrevented),je(_)),b=ne(i=>{if(!e.disabled)return o("click",i),i.type!=="keydown"&&i.defaultPrevented},i=>{var h,C,S;if(e.disabled){i.stopImmediatePropagation();return}(h=l==null?void 0:l.hideOnClick)!=null&&h.value&&((C=l.handleClick)==null||C.call(l)),(S=l.commandHandler)==null||S.call(l,e.command,d,i)}),A=B(()=>({...e,...r}));return{handleClick:b,handlePointerMove:t,handlePointerLeave:a,textContent:u,propsAndAttrs:A}}});function ut(e,o,r,l,d,s){var u;const v=L("el-dropdown-item-impl"),_=L("el-roving-focus-item"),t=L("el-dropdown-collection-item");return w(),J(t,{disabled:e.disabled,"text-value":(u=e.textValue)!=null?u:e.textContent},{default:m(()=>[f(_,{focusable:!e.disabled},{default:m(()=>[f(v,he(e.propsAndAttrs,{onPointerleave:e.handlePointerLeave,onPointermove:e.handlePointerMove,onClickimpl:e.handleClick}),{default:m(()=>[q(e.$slots,"default")]),_:3},16,["onPointerleave","onPointermove","onClickimpl"])]),_:3},8,["focusable"])]),_:3},8,["disabled","text-value"])}var ko=te(dt,[["render",ut],["__file","dropdown-item.vue"]]);const pt=Q({name:"ElDropdownMenu",props:qn,setup(e){const o=Se("dropdown"),{_elDropdownSize:r}=Io(),l=r.value,{focusTrapRef:d,onKeydown:s}=X(Go,void 0),{contentRef:u,role:v,triggerId:_}=X(Me,void 0),{collectionRef:t,getItems:a}=X(Zn,void 0),{rovingFocusGroupRef:b,rovingFocusGroupRootStyle:A,tabIndex:i,onBlur:h,onFocus:C,onMousedown:S}=X(He,void 0),{collectionRef:P}=X(Ue,void 0),N=B(()=>[o.b("menu"),o.bm("menu",l==null?void 0:l.value)]),M=mo(u,t,d,b,P),R=ne(K=>{var G;(G=e.onKeydown)==null||G.call(e,K)},K=>{const{currentTarget:G,code:$,target:n}=K;if(G.contains(n),z.tab===$&&K.stopImmediatePropagation(),K.preventDefault(),n!==p(u)||!Wn.includes($))return;const E=a().filter(I=>!I.disabled).map(I=>I.ref);$o.includes($)&&E.reverse(),Ge(E)});return{size:l,rovingFocusGroupRootStyle:A,tabIndex:i,dropdownKls:N,role:v,triggerId:_,dropdownListWrapperRef:M,handleKeydown:K=>{R(K),s(K)},onBlur:h,onFocus:C,onMousedown:S}}});function ft(e,o,r,l,d,s){return w(),D("ul",{ref:e.dropdownListWrapperRef,class:F(e.dropdownKls),style:Fe(e.rovingFocusGroupRootStyle),tabindex:-1,role:e.role,"aria-labelledby":e.triggerId,onBlur:e.onBlur,onFocus:e.onFocus,onKeydown:le(e.handleKeydown,["self"]),onMousedown:le(e.onMousedown,["self"])},[q(e.$slots,"default")],46,["role","aria-labelledby","onBlur","onFocus","onKeydown","onMousedown"])}var To=te(pt,[["render",ft],["__file","dropdown-menu.vue"]]);const mt=io(tt,{DropdownItem:ko,DropdownMenu:To}),vt=vo(ko),gt=vo(To),Ae="_trap-focus-children",ie=[],to=e=>{if(ie.length===0)return;const o=ie[ie.length-1][Ae];if(o.length>0&&e.code===z.tab){if(o.length===1){e.preventDefault(),document.activeElement!==o[0]&&o[0].focus();return}const r=e.shiftKey,l=e.target===o[0],d=e.target===o[o.length-1];l&&r&&(e.preventDefault(),o[o.length-1].focus()),d&&!r&&(e.preventDefault(),o[0].focus())}},ht={beforeMount(e){e[Ae]=We(e),ie.push(e),ie.length<=1&&document.addEventListener("keydown",to)},updated(e){de(()=>{e[Ae]=We(e)})},unmounted(){ie.shift(),ie.length===0&&document.removeEventListener("keydown",to)}},_t=Q({name:"ElMessageBox",directives:{TrapFocus:ht},components:{ElButton:Be,ElFocusTrap:ro,ElInput:Ve,ElOverlay:lo,ElIcon:fe,...Jo},inheritAttrs:!1,props:{buttonSize:{type:String,validator:fn},modal:{type:Boolean,default:!0},lockScroll:{type:Boolean,default:!0},showClose:{type:Boolean,default:!0},closeOnClickModal:{type:Boolean,default:!0},closeOnPressEscape:{type:Boolean,default:!0},closeOnHashChange:{type:Boolean,default:!0},center:Boolean,draggable:Boolean,overflow:Boolean,roundButton:{default:!1,type:Boolean},container:{type:String,default:"body"},boxType:{type:String,default:""}},emits:["vanish","action"],setup(e,{emit:o}){const{locale:r,zIndex:l,ns:d,size:s}=Yo("message-box",B(()=>e.buttonSize)),{t:u}=r,{nextZIndex:v}=l,_=O(!1),t=_e({autofocus:!0,beforeClose:null,callback:null,cancelButtonText:"",cancelButtonClass:"",confirmButtonText:"",confirmButtonClass:"",customClass:"",customStyle:{},dangerouslyUseHTMLString:!1,distinguishCancelAndClose:!1,icon:"",closeIcon:"",inputPattern:null,inputPlaceholder:"",inputType:"text",inputValue:"",inputValidator:void 0,inputErrorMessage:"",message:"",modalFade:!0,modalClass:"",showCancelButton:!1,showConfirmButton:!0,type:"",title:void 0,showInput:!1,action:"",confirmButtonLoading:!1,cancelButtonLoading:!1,confirmButtonLoadingIcon:Le(Xe),cancelButtonLoadingIcon:Le(Xe),confirmButtonDisabled:!1,editorErrorMessage:"",validateError:!1,zIndex:v()}),a=B(()=>{const c=t.type;return{[d.bm("icon",c)]:c&&Qe[c]}}),b=Te(),A=Te(),i=B(()=>{const c=t.type;return t.icon||c&&Qe[c]||""}),h=B(()=>!!t.message),C=O(),S=O(),P=O(),N=O(),M=O(),R=B(()=>t.confirmButtonClass);ke(()=>t.inputValue,async c=>{await de(),e.boxType==="prompt"&&c&&I()},{immediate:!0}),ke(()=>_.value,c=>{var T,k;c&&(e.boxType!=="prompt"&&(t.autofocus?P.value=(k=(T=M.value)==null?void 0:T.$el)!=null?k:C.value:P.value=C.value),t.zIndex=v()),e.boxType==="prompt"&&(c?de().then(()=>{var W;N.value&&N.value.$el&&(t.autofocus?P.value=(W=U())!=null?W:C.value:P.value=C.value)}):(t.editorErrorMessage="",t.validateError=!1))});const V=B(()=>e.draggable),K=B(()=>e.overflow);qo(C,S,V,K),De(async()=>{await de(),e.closeOnHashChange&&window.addEventListener("hashchange",G)}),ze(()=>{e.closeOnHashChange&&window.removeEventListener("hashchange",G)});function G(){_.value&&(_.value=!1,de(()=>{t.action&&o("action",t.action)}))}const $=()=>{e.closeOnClickModal&&E(t.distinguishCancelAndClose?"close":"cancel")},n=Xo($),g=c=>{if(t.inputType!=="textarea")return c.preventDefault(),E("confirm")},E=c=>{var T;e.boxType==="prompt"&&c==="confirm"&&!I()||(t.action=c,t.beforeClose?(T=t.beforeClose)==null||T.call(t,c,t,G):G())},I=()=>{if(e.boxType==="prompt"){const c=t.inputPattern;if(c&&!c.test(t.inputValue||""))return t.editorErrorMessage=t.inputErrorMessage||u("el.messagebox.error"),t.validateError=!0,!1;const T=t.inputValidator;if(Re(T)){const k=T(t.inputValue);if(k===!1)return t.editorErrorMessage=t.inputErrorMessage||u("el.messagebox.error"),t.validateError=!0,!1;if(Ke(k))return t.editorErrorMessage=k,t.validateError=!0,!1}}return t.editorErrorMessage="",t.validateError=!1,!0},U=()=>{var c,T;const k=(c=N.value)==null?void 0:c.$refs;return(T=k==null?void 0:k.input)!=null?T:k==null?void 0:k.textarea},se=()=>{E("close")},Z=()=>{e.closeOnPressEscape&&se()};return e.lockScroll&&jo(_),{...Wo(t),ns:d,overlayEvent:n,visible:_,hasMessage:h,typeClass:a,contentId:b,inputId:A,btnSize:s,iconComponent:i,confirmButtonClasses:R,rootRef:C,focusStartRef:P,headerRef:S,inputRef:N,confirmRef:M,doClose:G,handleClose:se,onCloseRequested:Z,handleWrapperClick:$,handleInputEnter:g,handleAction:E,t:u}}});function bt(e,o,r,l,d,s){const u=L("el-icon"),v=L("el-input"),_=L("el-button"),t=L("el-focus-trap"),a=L("el-overlay");return w(),J(Ne,{name:"fade-in-linear",onAfterLeave:b=>e.$emit("vanish"),persisted:""},{default:m(()=>[oe(f(a,{"z-index":e.zIndex,"overlay-class":[e.ns.is("message-box"),e.modalClass],mask:e.modal},{default:m(()=>[y("div",{role:"dialog","aria-label":e.title,"aria-modal":"true","aria-describedby":e.showInput?void 0:e.contentId,class:F(`${e.ns.namespace.value}-overlay-message-box`),onClick:e.overlayEvent.onClick,onMousedown:e.overlayEvent.onMousedown,onMouseup:e.overlayEvent.onMouseup},[f(t,{loop:"",trapped:e.visible,"focus-trap-el":e.rootRef,"focus-start-el":e.focusStartRef,onReleaseRequested:e.onCloseRequested},{default:m(()=>[y("div",{ref:"rootRef",class:F([e.ns.b(),e.customClass,e.ns.is("draggable",e.draggable),{[e.ns.m("center")]:e.center}]),style:Fe(e.customStyle),tabindex:"-1",onClick:le(()=>{},["stop"])},[e.title!==null&&e.title!==void 0?(w(),D("div",{key:0,ref:"headerRef",class:F([e.ns.e("header"),{"show-close":e.showClose}])},[y("div",{class:F(e.ns.e("title"))},[e.iconComponent&&e.center?(w(),J(u,{key:0,class:F([e.ns.e("status"),e.typeClass])},{default:m(()=>[(w(),J(ce(e.iconComponent)))]),_:1},8,["class"])):Y("v-if",!0),y("span",null,H(e.title),1)],2),e.showClose?(w(),D("button",{key:0,type:"button",class:F(e.ns.e("headerbtn")),"aria-label":e.t("el.messagebox.close"),onClick:b=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),onKeydown:$e(le(b=>e.handleAction(e.distinguishCancelAndClose?"close":"cancel"),["prevent"]),["enter"])},[f(u,{class:F(e.ns.e("close"))},{default:m(()=>[(w(),J(ce(e.closeIcon||"close")))]),_:1},8,["class"])],42,["aria-label","onClick","onKeydown"])):Y("v-if",!0)],2)):Y("v-if",!0),y("div",{id:e.contentId,class:F(e.ns.e("content"))},[y("div",{class:F(e.ns.e("container"))},[e.iconComponent&&!e.center&&e.hasMessage?(w(),J(u,{key:0,class:F([e.ns.e("status"),e.typeClass])},{default:m(()=>[(w(),J(ce(e.iconComponent)))]),_:1},8,["class"])):Y("v-if",!0),e.hasMessage?(w(),D("div",{key:1,class:F(e.ns.e("message"))},[q(e.$slots,"default",{},()=>[e.dangerouslyUseHTMLString?(w(),J(ce(e.showInput?"label":"p"),{key:1,for:e.showInput?e.inputId:void 0,innerHTML:e.message},null,8,["for","innerHTML"])):(w(),J(ce(e.showInput?"label":"p"),{key:0,for:e.showInput?e.inputId:void 0},{default:m(()=>[ee(H(e.dangerouslyUseHTMLString?"":e.message),1)]),_:1},8,["for"]))])],2)):Y("v-if",!0)],2),oe(y("div",{class:F(e.ns.e("input"))},[f(v,{id:e.inputId,ref:"inputRef",modelValue:e.inputValue,"onUpdate:modelValue":b=>e.inputValue=b,type:e.inputType,placeholder:e.inputPlaceholder,"aria-invalid":e.validateError,class:F({invalid:e.validateError}),onKeydown:$e(e.handleInputEnter,["enter"])},null,8,["id","modelValue","onUpdate:modelValue","type","placeholder","aria-invalid","class","onKeydown"]),y("div",{class:F(e.ns.e("errormsg")),style:Fe({visibility:e.editorErrorMessage?"visible":"hidden"})},H(e.editorErrorMessage),7)],2),[[Ie,e.showInput]])],10,["id"]),y("div",{class:F(e.ns.e("btns"))},[e.showCancelButton?(w(),J(_,{key:0,loading:e.cancelButtonLoading,"loading-icon":e.cancelButtonLoadingIcon,class:F([e.cancelButtonClass]),round:e.roundButton,size:e.btnSize,onClick:b=>e.handleAction("cancel"),onKeydown:$e(le(b=>e.handleAction("cancel"),["prevent"]),["enter"])},{default:m(()=>[ee(H(e.cancelButtonText||e.t("el.messagebox.cancel")),1)]),_:1},8,["loading","loading-icon","class","round","size","onClick","onKeydown"])):Y("v-if",!0),oe(f(_,{ref:"confirmRef",type:"primary",loading:e.confirmButtonLoading,"loading-icon":e.confirmButtonLoadingIcon,class:F([e.confirmButtonClasses]),round:e.roundButton,disabled:e.confirmButtonDisabled,size:e.btnSize,onClick:b=>e.handleAction("confirm"),onKeydown:$e(le(b=>e.handleAction("confirm"),["prevent"]),["enter"])},{default:m(()=>[ee(H(e.confirmButtonText||e.t("el.messagebox.confirm")),1)]),_:1},8,["loading","loading-icon","class","round","disabled","size","onClick","onKeydown"]),[[Ie,e.showConfirmButton]])],2)],14,["onClick"])]),_:3},8,["trapped","focus-trap-el","focus-start-el","onReleaseRequested"])],42,["aria-label","aria-describedby","onClick","onMousedown","onMouseup"])]),_:3},8,["z-index","overlay-class","mask"]),[[Ie,e.visible]])]),_:3},8,["onAfterLeave"])}var yt=te(_t,[["render",bt],["__file","index.vue"]]);const ye=new Map,wt=e=>{let o=document.body;return e.appendTo&&(Ke(e.appendTo)&&(o=document.querySelector(e.appendTo)),xe(e.appendTo)&&(o=e.appendTo),xe(o)||(o=document.body)),o},Ct=(e,o,r=null)=>{const l=f(yt,e,Re(e.message)||go(e.message)?{default:Re(e.message)?e.message:()=>e.message}:null);return l.appContext=r,ho(l,o),wt(e).appendChild(o.firstElementChild),l.component},Et=()=>document.createElement("div"),$t=(e,o)=>{const r=Et();e.onVanish=()=>{ho(null,r),ye.delete(d)},e.onAction=s=>{const u=ye.get(d);let v;e.showInput?v={value:d.inputValue,action:s}:v=s,e.callback?e.callback(v,l.proxy):s==="cancel"||s==="close"?e.distinguishCancelAndClose&&s!=="cancel"?u.reject("close"):u.reject("cancel"):u.resolve(v)};const l=Ct(e,r,o),d=l.proxy;for(const s in e)Ze(e,s)&&!Ze(d.$props,s)&&(s==="closeIcon"&&_o(e[s])?d[s]=Le(e[s]):d[s]=e[s]);return d.visible=!0,d};function me(e,o=null){if(!Qo)return Promise.reject();let r;return Ke(e)||go(e)?e={message:e}:r=e.callback,new Promise((l,d)=>{const s=$t(e,o??me._context);ye.set(s,{options:e,callback:r,resolve:l,reject:d})})}const It=["alert","confirm","prompt"],kt={alert:{closeOnPressEscape:!1,closeOnClickModal:!1},confirm:{showCancelButton:!0},prompt:{showCancelButton:!0,showInput:!0}};It.forEach(e=>{me[e]=Tt(e)});function Tt(e){return(o,r,l,d)=>{let s="";return _o(r)?(l=r,s=""):Zo(r)?s="":s=r,me(Object.assign({title:s,message:o,type:"",...kt[e]},l,{boxType:e}),d)}}me.close=()=>{ye.forEach((e,o)=>{o.doClose()}),ye.clear()};me._context=null;const ae=me;ae.install=e=>{ae._context=e._context,e.config.globalProperties.$msgbox=ae,e.config.globalProperties.$messageBox=ae,e.config.globalProperties.$alert=ae.alert,e.config.globalProperties.$confirm=ae.confirm,e.config.globalProperties.$prompt=ae.prompt};const St=ae,Bt={class:"p-5 w-[596px]"},Mt={class:"flex items-center justify-between"},Ft={class:"text-lg text-primary"},Lt={class:"h-[300px] overflow-y-auto mt-5"},Rt={class:"grid grid-cols-2 gap-4"},Ot=["onClick"],At={class:"flex-1 overflow-hidden"},Nt={class:"text-base font-medium text-primary mb-1"},Pt={class:"text-sm text-secondary truncate"},Dt=Q({__name:"agent-tooltip",emits:["select"],setup(e,{emit:o}){const r=o,l=xo(),d=O(),s=_e({keyword:"",group_id:0}),u=B(()=>{if(s.keyword){const t=s.keyword.toLowerCase().trim();return l.agentList.filter(a=>{const b=a.name.toLowerCase().includes(t)||a.description&&a.description.toLowerCase().includes(t);return(s.group_id===0||a.group_id===s.group_id)&&b})}else return s.group_id===0?l.agentList:l.agentList.filter(t=>t.group_id===s.group_id)}),v=()=>{d.value.hide()},_=t=>{r("select",t),v()};return(t,a)=>{const b=fe,A=Ve,i=gn,h=hn,C=mn,S=pn,P=co,N=be("tooltip");return w(),J(P,{ref_key:"tooltipRef",ref:d,effect:"light",trigger:"click","popper-class":"el-popper--plain",placement:"top-start"},{content:m(()=>[y("div",Bt,[y("div",Mt,[y("h4",Ft,H(t.$t("action.find"))+H(t.$t("module.agent")),1),oe((w(),D("div",{class:"size-5 flex-center rounded cursor-pointer hover:bg-[#E1E2E3]",onClick:v},[f(b,null,{default:m(()=>[f(p(Pe))]),_:1})])),[[N,{content:t.$t("action.close")}]])]),f(A,{size:"large",modelValue:s.keyword,"onUpdate:modelValue":a[0]||(a[0]=M=>s.keyword=M),placeholder:t.$t("action.search")+t.$t("module.agent"),"prefix-icon":p(en),class:"mt-4 el-input--main"},null,8,["modelValue","placeholder","prefix-icon"]),f(h,{class:"index-tabs mt-4",modelValue:s.group_id,"onUpdate:modelValue":a[1]||(a[1]=M=>s.group_id=M)},{default:m(()=>[(w(!0),D(pe,null,Oe(p(l).categorys,M=>(w(),J(i,{key:M.group_id,label:M.group_name,name:M.group_id},null,8,["label","name"]))),128))]),_:1},8,["modelValue"]),y("div",Lt,[y("div",Rt,[(w(!0),D(pe,null,Oe(u.value,(M,R)=>(w(),D("div",{key:R,class:"flex items-center p-3 bg-[#F8F9FA] rounded-lg cursor-pointer",onClick:V=>_(M)},[f(C,{size:36,src:M.logo,class:"mr-2"},null,8,["src"]),y("div",At,[y("h3",Nt,H(M.name),1),y("p",Pt,H(M.description||"- -"),1)])],8,Ot))),128))]),u.value.length===0?(w(),J(S,{key:0,description:t.$t("common.no_data"),"image-size":100,image:t.$getPublicPath("/images/chat/completion_empty.png")},null,8,["description","image"])):Y("",!0)])])]),default:m(()=>[q(t.$slots,"default")]),_:3},512)}}}),zt={class:"flex flex-col gap-2 mt-4"},Vt=["onClick"],Kt={class:"flex items-center gap-2"},Ut={class:"flex-1 text-sm text-primary truncate"},Ht={class:"size-7 flex-center cursor-pointer invisible group-hover:visible"},Gt={class:"text-[#FA5151] flex-center"},Jt={class:"mt-2 text-xs text-secondary"},Yt=Q({__name:"history",emits:["new"],setup(e,{expose:o,emit:r}){const l=r,d=bo(),s=B(()=>d.currentConversation),u=O(!1),v=_e({editVisible:!1}),_=_e({conversation_id:0,title:""}),t=()=>{l("new"),u.value=!1},a=async()=>{await d.editConversation(_),v.editVisible=!1},b=async i=>{await St.confirm(window.$t("chat.conversation_confirm_delete"),window.$t("action.del"),{confirmButtonText:window.$t("action.del"),cancelButtonText:window.$t("action.cancel"),type:"warning"}),d.delConversation(i)},A=(i,h)=>{i==="del"?b(h):i==="edit"&&(_.conversation_id=h.conversation_id,_.title=h.title,v.editVisible=!0)};return o({open(){u.value=!0}}),(i,h)=>{const C=Be,S=L("svg-icon"),P=vt,N=gt,M=mt,R=$n,V=Ve,K=on,G=be("trim"),$=be("debounce");return w(),D(pe,null,[f(R,{modelValue:u.value,"onUpdate:modelValue":h[0]||(h[0]=n=>u.value=n),title:i.$t("chat.history"),size:"300px"},{default:m(()=>[f(C,{class:"w-full border-none -mt-8",type:"primary",size:"large",plain:"",onClick:t},{default:m(()=>[ee(" + "+H(i.$t("chat.new_conversation")),1)]),_:1}),y("div",zt,[(w(!0),D(pe,null,Oe(p(d).conversations,n=>(w(),D("div",{key:n.conversation_id,class:F(["group p-3 rounded cursor-pointer hover:bg-[#F5F6FA]",[s.value.conversation_id===n.conversation_id?"bg-[#F5F6FA]":""]]),onClick:g=>p(d).setCurrentState(n.agent_id,n.conversation_id)},[y("div",Kt,[y("div",Ut,H(n.title),1),f(M,{onCommand:g=>A(g,n)},{dropdown:m(()=>[f(N,null,{default:m(()=>[f(P,{command:"edit"},{default:m(()=>[f(S,{name:"edit",class:"mr-1"}),ee(" "+H(i.$t("action.rename")),1)]),_:1}),f(P,{command:"del"},{default:m(()=>[y("span",Gt,[f(S,{name:"del",class:"mr-1"}),ee(" "+H(i.$t("action.del")),1)])]),_:1})]),_:1})]),default:m(()=>[y("div",Ht,[f(S,{name:"more-h"})])]),_:2},1032,["onCommand"])]),y("div",Jt,H(n.created_at),1)],10,Vt))),128))])]),_:1},8,["modelValue","title"]),f(K,{modelValue:v.editVisible,"onUpdate:modelValue":h[3]||(h[3]=n=>v.editVisible=n),title:i.$t("chat.edit_conversation"),width:"480"},{footer:m(()=>[f(C,{onClick:h[2]||(h[2]=n=>v.editVisible=!1)},{default:m(()=>[ee(H(i.$t("action.cancel")),1)]),_:1}),oe((w(),J(C,{type:"primary",disabled:!_.title.trim(),onClick:a},{default:m(()=>[ee(H(i.$t("action.confirm")),1)]),_:1},8,["disabled"])),[[$]])]),default:m(()=>[oe(f(V,{size:"large",modelValue:_.title,"onUpdate:modelValue":h[1]||(h[1]=n=>_.title=n),placeholder:i.$t("form.input_placeholder"),maxlength:20,"show-word-limit":""},null,8,["modelValue","placeholder"]),[[G]])]),_:1},8,["modelValue","title"])],64)}}}),qt={completions(e,o){return nn.post("/v1/chat/completions",e,o).catch(tn)}},jt={class:"h-full flex bg-white relative overflow-hidden"},Wt={class:"flex-1 flex flex-col"},Xt=["title"],Qt={class:"flex items-center gap-1 text-sm text-secondary"},Zt={class:"size-4"},xt={class:"h-6 px-1 rounded flex-center cursor-pointer hover:bg-[#E1E2E3]"},es={class:"h-6 px-1 rounded flex-center cursor-pointer hover:bg-[#E1E2E3]"},os=["onClick"];const ns={class:"w-4/5 max-w-[800px] mx-auto py-5"},ts={class:"flex gap-2 mb-2.5"},ss={class:"h-8 px-2 rounded-full flex-center gap-1.5 bg-[#F1F2F3] cursor-pointer hover:bg-[#E1E2E3]"},as=["src"],ls={class:"text-sm text-primary"},rs={class:"size-4 flex-center"},is={class:"size-4"},cs={class:"size-4"},ds={key:0,class:"w-2/5 border-l bg-white"},us={class:"h-16 flex-center border-b relative"},ps={class:"text-lg text-primary"},fs=Q({__name:"index",setup(e){const o=an(()=>ln(()=>import("./helper-KDpW-Map.js"),__vite__mapDeps([0,1,2,3,4]))),r=bo(),l=O(),d=O(null),s=B(()=>r.currentAgent),u=B(()=>r.currentConversation),v=B(()=>r.currentAgent.custom_config_obj),_=B(()=>{var n,g,E,I;return!!((g=(n=v.value)==null?void 0:n.file_parse)!=null&&g.enable||(I=(E=v.value)==null?void 0:E.image_parse)!=null&&I.enable)}),t=B(()=>{var g,E,I,U;let n="";return(E=(g=v.value)==null?void 0:g.file_parse)!=null&&E.enable&&(n+=".pdf,.doc,.docx,.xls,.xlsx,.ppt,.pptx,.csv,.txt,.html,.json,.xml,.md"),(U=(I=v.value)==null?void 0:I.image_parse)!=null&&U.enable&&(n+=",image/*"),n}),a=_e({offset:0,limit:10,showHelper:!1,messageList:[],isStreaming:!1,isLoadingMore:!1,hasMore:!0}),b=()=>{var n;(n=l.value)==null||n.open()},A=()=>{a.showHelper=!a.showHelper},i=n=>{r.pushUsualAgent(n),r.setCurrentState(n.agent_id,0)},h=()=>{r.setCurrentState(s.value.agent_id,0)},C=async n=>{try{const g=await vn.upload(n);return{id:g.data.id,url:`${window.api_host}/api/preview/${g.data.preview_key||""}`,size:g.data.size,name:g.data.file_name,mime_type:g.data.mime_type}}catch{return{}}},S=(n,g)=>{var Z,c,T,k,W,j,re;const E=a.messageList[a.messageList.length-1];if(!((Z=n.event)!=null&&Z.target))return g;const I=n.event.target.response||"",U=I.substring(g),se=I.length;try{const Ce=U.split(`
`).filter(ve=>ve.trim()!==""&&ve.trim()!=="data: [DONE]");for(const ve of Ce)if(ve.startsWith("data: "))try{const Ee=JSON.parse(ve.slice(6)),Je=(k=(T=(c=Ee.choices)==null?void 0:c[0])==null?void 0:T.delta)==null?void 0:k.content,Ye=(re=(j=(W=Ee.choices)==null?void 0:W[0])==null?void 0:j.delta)==null?void 0:re.reasoning_content;Je&&(E.answer+=Je),Ye&&(E.reasoning_content+=Ye)}catch(Ee){console.error("解析JSON失败:",Ee)}}catch(Ce){console.error("处理流数据失败:",Ce)}return se},P={formatMessage:n=>{var I;const g={...n,query:""},E=JSON.parse(n.message)[0].content;try{const U=JSON.parse(E),se=(I=U.find(Z=>Z.type==="text"))==null?void 0:I.content;g.query=se,g.user_files=U.filter(Z=>Z.type==="image")}catch{g.query=E}return g},formatFiles:n=>(n==null?void 0:n.map(g=>({type:"image",content:`file_id:${g.id}`,filename:g.name,size:g.size,mime_type:g.mime_type,url:g.url})))||[],createNewMessage:(n,g,E,I)=>({query:n,answer:"",loading:!0,agent_id:g,conversation_id:E,reasoning_content:"",reasoning_expanded:!0,user_files:I})},N=async(n,g,E)=>{try{const U=(await _n.messasges(n,{offset:g,limit:E})).data.messages.map(P.formatMessage);return{messages:U,hasMore:U.length===E}}catch(I){return console.error("加载消息失败:",I),{messages:[],hasMore:!1}}},M=async n=>{if(a.isLoadingMore||!a.hasMore)return n();const g=u.value.conversation_id;if(g){a.isLoadingMore=!0,a.offset+=a.limit;try{const{messages:E,hasMore:I}=await N(g,a.offset,a.limit);a.hasMore=I,a.messageList.unshift(...E)}catch{a.offset=Math.max(0,a.offset-a.limit)}finally{a.isLoadingMore=!1,n()}}},R=async()=>{const n=u.value.conversation_id;if(n){a.isLoadingMore=!0,a.offset=0,a.hasMore=!0;try{const{messages:g,hasMore:E}=await N(n,a.offset,a.limit);a.hasMore=E,a.messageList=g}finally{a.isLoadingMore=!1}}},V=async(n,g)=>{if(a.isStreaming)return;const E=s.value.agent_id,I=u.value.conversation_id,U=P.createNewMessage(n,E,I,g);a.messageList.push(U);const Z=JSON.parse(s.value.configs||"{}").completion_params||{};a.isStreaming=!0,d.value=new AbortController;let c=0,T=n;g.length>0&&(T=JSON.stringify([{type:"text",content:n},...g]));try{await qt.completions({conversation_id:I,model:"agent-"+E,messages:[{content:T,role:"user"}],frequency_penalty:0,presence_penalty:0,stream:!0,temperature:0,top_p:0,...Z},{responseType:"stream",onDownloadProgress:k=>{c=S(k,c)},signal:d.value.signal})}catch(k){if(k.message!=="canceled"){console.log(k);const W=a.messageList[a.messageList.length-1];W&&!W.answer&&(W.answer=k.response.data||window.$t("response_code.network_error"))}}finally{const k=a.messageList[a.messageList.length-1];k&&(k.loading=!1),a.isStreaming=!1,d.value=null}},K=async(n,g)=>{const E=s.value.agent_id;if(!E)return rn.warning(window.$t("chat.no_available_agent"));if(!u.value.conversation_id)try{const I=await r.createConversation(E,n);r.addConversation({...I,virtual_id:u.value.virtual_id}),r.setCurrentState(I.agent_id,I.conversation_id)}catch(I){console.error("创建对话失败:",I);return}await V(n,P.formatFiles(g))},G=()=>{d.value&&(d.value.abort(),d.value=null),a.isStreaming=!1},$=async n=>{await V(n.query,n.user_files)};return De(()=>{R()}),(n,g)=>{const E=L("svg-icon"),I=L("router-link"),U=fe,se=L("x-bubble-user"),Z=L("x-bubble-assistant"),c=L("x-bubble-list"),T=L("x-sender"),k=be("tooltip"),W=be("copy");return w(),D(pe,null,[y("div",jt,[y("div",Wt,[f(dn,null,{before_suffix:m(()=>[y("div",{class:"text-base text-primary line-clamp-1",title:u.value.title||s.value.name||""},H(u.value.title||s.value.name||""),9,Xt)]),after_prefix:m(()=>[y("div",Qt,[f(E,{name:"index"}),f(I,{to:{name:"Home"}},{default:m(()=>[ee(H(n.$t("common.back_home")),1)]),_:1})]),g[0]||(g[0]=y("div",{class:"border-r w-px h-3 mx-2"},null,-1))]),after_suffix:m(()=>[oe((w(),D("div",{class:"h-[26px] px-2 rounded-full flex-center gap-1.5 text-sm text-primary cursor-pointer hover:bg-[#E1E2E3]",onClick:A},[y("div",Zt,[f(E,{name:"layout-split",size:"18"})])])),[[k,{content:n.$t("chat.usage_guide")}]])]),_:1}),f(c,{class:"flex-1 mt-5",autoScroll:!0,messages:a.messageList,mainClass:"w-4/5 max-w-[800px] mx-auto",enablePullUp:"",onPullUp:M},{item:m(({message:j,index:re})=>[f(se,{content:j.query,files:j.user_files},{menu:m(()=>[oe((w(),D("div",xt,[f(U,{color:"#9B9B9B"},{default:m(()=>[f(p(eo))]),_:1})])),[[k,{content:n.$t("action.copy")}],[W,j.query]])]),_:2},1032,["content","files"]),f(Z,{content:j.answer,reasoning:j.reasoning_content,"reasoning-expanded":j.reasoning_expanded,streaming:j.loading,alwaysShowMenu:re===a.messageList.length-1},fo({_:2},[j.loading?void 0:{name:"menu",fn:m(()=>[oe((w(),D("div",es,[f(U,{color:"#9B9B9B"},{default:m(()=>[f(p(eo))]),_:1})])),[[k,{content:n.$t("action.copy")}],[W,j.answer]]),oe((w(),D("div",{class:"h-6 px-1 rounded flex-center cursor-pointer hover:bg-[#E1E2E3]",onClick:Ce=>$(j)},[f(U,{color:"#9B9B9B"},{default:m(()=>[f(p(sn))]),_:1})],8,os)),[[k,{content:n.$t("chat.regenerate")}]]),Y("",!0),Y("",!0)]),key:"0"}]),1032,["content","reasoning","reasoning-expanded","streaming","alwaysShowMenu"])]),_:1},8,["messages"]),y("div",ns,[y("div",ts,[f(Dt,{onSelect:i},{default:m(()=>[y("div",ss,[y("img",{class:"size-4 rounded-full",src:s.value.logo,alt:""},null,8,as),y("span",ls,H(s.value.name),1),y("div",rs,[f(U,{color:"#333333"},{default:m(()=>[f(p(uo))]),_:1})])])]),_:1}),Y("",!0),g[1]||(g[1]=y("div",{class:"flex-1"},null,-1)),y("div",{class:"h-8 px-2 rounded-full flex-center gap-1.5 bg-[#F1F2F3] text-sm text-primary cursor-pointer hover:bg-[#E1E2E3]",onClick:b},[y("div",is,[f(E,{name:"history"})]),ee(" "+H(n.$t("chat.history")),1)]),y("div",{class:"h-8 px-2 rounded-full flex-center gap-1.5 bg-[#F1F2F3] text-sm text-primary cursor-pointer hover:bg-[#E1E2E3]",onClick:h},[y("div",cs,[f(E,{name:"plus"})]),ee(" "+H(n.$t("chat.new_conversation")),1)])]),f(T,{"http-request":C,"enable-upload":_.value,"accept-types":t.value,loading:a.isStreaming,onSend:K,onStop:G},null,8,["enable-upload","accept-types","loading"])])]),f(Ne,{name:"slide"},{default:m(()=>[a.showHelper?(w(),D("div",ds,[y("div",us,[y("h4",ps,H(n.$t("chat.usage_guide")),1),y("div",{class:"flex-center size-6 absolute right-2 top-1/2 -translate-y-1/2 rounded cursor-pointer hover:bg-[#ECEDEE]",onClick:A},[f(U,null,{default:m(()=>[f(p(Pe))]),_:1})])]),f(p(o),{agent:s.value},null,8,["agent"])])):Y("",!0)]),_:1})]),f(Yt,{ref_key:"historyRef",ref:l,onNew:h},null,512)],64)}}}),Ss=cn(fs,[["__scopeId","data-v-6dff0009"]]);export{Ss as default};
function __vite__mapDeps(indexes) {
  if (!__vite__mapDeps.viteFileDeps) {
    __vite__mapDeps.viteFileDeps = ["assets/helper-KDpW-Map.js","assets/main-B8r1lKmx.js","assets/main-1F2bDwlu.css","assets/el-empty-Keg8_2xc.js","assets/el-empty-YAdQPiXB.css"]
  }
  return indexes.map((i) => __vite__mapDeps.viteFileDeps[i])
}
